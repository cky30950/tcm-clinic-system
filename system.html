<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¹›å‡Œè¨ºæ‰€ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
<script type="module" src="firebase_init.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* æµ®å‹•æç¤ºæ¨£å¼ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            max-width: 500px;
            padding: 16px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: all 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .toast.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .toast-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .toast-content {
            flex: 1;
            line-height: 1.4;
        }

        /* è®“ç—…æ­·æ¬„ä½å…§å®¹é•·å­—ä¸²æ›è¡Œé¿å…æº¢å‡º */
        .medical-field {
            /* å…è¨±åœ¨ä»»æ„å­—å…ƒæ–·è¡Œï¼Œé¿å…å…§å®¹æº¢å‡ºæ¬„ä½ */
            word-break: break-all;
            overflow-wrap: break-word;
        }

        /*
         * Amber palette overrides
         * ç‚ºäº†è®“ system.html çš„é…è‰²èˆ‡ index.html ä¸€è‡´ï¼Œè¦†å¯«æ‰€æœ‰ç¶ è‰²ã€è—è‰²ã€ç´«è‰²ã€ç´…è‰²ã€é»ƒè‰²çš„èƒŒæ™¯ã€æ–‡å­—ã€é‚Šæ¡†èˆ‡ hover æ•ˆæœã€‚
         * é€™äº›æ¨£å¼ä½¿ç”¨ tailwind çš„åŒåé¡åˆ¥ï¼Œä½†å¥—ç”¨ç¥ç€è‰²èª¿çš„å€¼ï¼Œä½¿é é¢å‘ˆç¾çµ±ä¸€çš„è‰²å½©é¢¨æ ¼ã€‚
         */
        /* èƒŒæ™¯é¡è‰²è¦†å¯« */
        .bg-green-50, .bg-blue-50, .bg-purple-50, .bg-red-50, .bg-yellow-50 { background-color: #fffbeb !important; }
        .bg-green-100, .bg-blue-100, .bg-purple-100, .bg-red-100, .bg-yellow-100 { background-color: #fef3c7 !important; }
        .bg-green-200, .bg-blue-200, .bg-purple-200, .bg-red-200, .bg-yellow-200 { background-color: #fde68a !important; }
        .bg-green-300, .bg-blue-300, .bg-purple-300, .bg-red-300, .bg-yellow-300 { background-color: #fcd34d !important; }
        .bg-green-400, .bg-blue-400, .bg-purple-400, .bg-red-400, .bg-yellow-400 { background-color: #fbbf24 !important; }
        .bg-green-500, .bg-blue-500, .bg-purple-500, .bg-red-500, .bg-yellow-500 { background-color: #f59e0b !important; }
        .bg-green-600, .bg-blue-600, .bg-purple-600, .bg-red-600, .bg-yellow-600 { background-color: #d97706 !important; }
        .bg-green-700, .bg-blue-700, .bg-purple-700, .bg-red-700, .bg-yellow-700 { background-color: #b45309 !important; }
        .bg-green-800, .bg-blue-800, .bg-purple-800, .bg-red-800, .bg-yellow-800 { background-color: #92400e !important; }
        .bg-green-900, .bg-blue-900, .bg-purple-900, .bg-red-900, .bg-yellow-900 { background-color: #78350f !important; }

        /* æ–‡å­—é¡è‰²è¦†å¯« */
        .text-green-50, .text-blue-50, .text-purple-50, .text-red-50, .text-yellow-50 { color: #fffbeb !important; }
        .text-green-100, .text-blue-100, .text-purple-100, .text-red-100, .text-yellow-100 { color: #fef3c7 !important; }
        .text-green-200, .text-blue-200, .text-purple-200, .text-red-200, .text-yellow-200 { color: #fde68a !important; }
        .text-green-300, .text-blue-300, .text-purple-300, .text-red-300, .text-yellow-300 { color: #fcd34d !important; }
        .text-green-400, .text-blue-400, .text-purple-400, .text-red-400, .text-yellow-400 { color: #fbbf24 !important; }
        .text-green-500, .text-blue-500, .text-purple-500, .text-red-500, .text-yellow-500 { color: #f59e0b !important; }
        .text-green-600, .text-blue-600, .text-purple-600, .text-red-600, .text-yellow-600 { color: #d97706 !important; }
        .text-green-700, .text-blue-700, .text-purple-700, .text-red-700, .text-yellow-700 { color: #b45309 !important; }
        .text-green-800, .text-blue-800, .text-purple-800, .text-red-800, .text-yellow-800 { color: #92400e !important; }
        .text-green-900, .text-blue-900, .text-purple-900, .text-red-900, .text-yellow-900 { color: #78350f !important; }

        /* é‚Šæ¡†é¡è‰²è¦†å¯« */
        .border-green-50, .border-blue-50, .border-purple-50, .border-red-50, .border-yellow-50 { border-color: #fffbeb !important; }
        .border-green-100, .border-blue-100, .border-purple-100, .border-red-100, .border-yellow-100 { border-color: #fef3c7 !important; }
        .border-green-200, .border-blue-200, .border-purple-200, .border-red-200, .border-yellow-200 { border-color: #fde68a !important; }
        .border-green-300, .border-blue-300, .border-purple-300, .border-red-300, .border-yellow-300 { border-color: #fcd34d !important; }
        .border-green-400, .border-blue-400, .border-purple-400, .border-red-400, .border-yellow-400 { border-color: #fbbf24 !important; }
        .border-green-500, .border-blue-500, .border-purple-500, .border-red-500, .border-yellow-500 { border-color: #f59e0b !important; }
        .border-green-600, .border-blue-600, .border-purple-600, .border-red-600, .border-yellow-600 { border-color: #d97706 !important; }
        .border-green-700, .border-blue-700, .border-purple-700, .border-red-700, .border-yellow-700 { border-color: #b45309 !important; }
        .border-green-800, .border-blue-800, .border-purple-800, .border-red-800, .border-yellow-800 { border-color: #92400e !important; }
        .border-green-900, .border-blue-900, .border-purple-900, .border-red-900, .border-yellow-900 { border-color: #78350f !important; }

        /* hover èƒŒæ™¯é¡è‰²è¦†å¯« */
        .hover\:bg-green-50:hover, .hover\:bg-blue-50:hover, .hover\:bg-purple-50:hover, .hover\:bg-red-50:hover, .hover\:bg-yellow-50:hover { background-color: #fffbeb !important; }
        .hover\:bg-green-100:hover, .hover\:bg-blue-100:hover, .hover\:bg-purple-100:hover, .hover\:bg-red-100:hover, .hover\:bg-yellow-100:hover { background-color: #fef3c7 !important; }
        .hover\:bg-green-200:hover, .hover\:bg-blue-200:hover, .hover\:bg-purple-200:hover, .hover\:bg-red-200:hover, .hover\:bg-yellow-200:hover { background-color: #fde68a !important; }
        .hover\:bg-green-300:hover, .hover\:bg-blue-300:hover, .hover\:bg-purple-300:hover, .hover\:bg-red-300:hover, .hover\:bg-yellow-300:hover { background-color: #fcd34d !important; }
        .hover\:bg-green-400:hover, .hover\:bg-blue-400:hover, .hover\:bg-purple-400:hover, .hover\:bg-red-400:hover, .hover\:bg-yellow-400:hover { background-color: #fbbf24 !important; }
        .hover\:bg-green-500:hover, .hover\:bg-blue-500:hover, .hover\:bg-purple-500:hover, .hover\:bg-red-500:hover, .hover\:bg-yellow-500:hover { background-color: #f59e0b !important; }
        .hover\:bg-green-600:hover, .hover\:bg-blue-600:hover, .hover\:bg-purple-600:hover, .hover\:bg-red-600:hover, .hover\:bg-yellow-600:hover { background-color: #d97706 !important; }
        .hover\:bg-green-700:hover, .hover\:bg-blue-700:hover, .hover\:bg-purple-700:hover, .hover\:bg-red-700:hover, .hover\:bg-yellow-700:hover { background-color: #b45309 !important; }
        .hover\:bg-green-800:hover, .hover\:bg-blue-800:hover, .hover\:bg-purple-800:hover, .hover\:bg-red-800:hover, .hover\:bg-yellow-800:hover { background-color: #92400e !important; }
        .hover\:bg-green-900:hover, .hover\:bg-blue-900:hover, .hover\:bg-purple-900:hover, .hover\:bg-red-900:hover, .hover\:bg-yellow-900:hover { background-color: #78350f !important; }

        /* ç„¦é»ç’°é¡è‰²è¦†å¯«ï¼šå°‡å„é¡é¡è‰²ç„¦é»çš„ç’°é¡è‰²æ”¹ç‚º amber-500 */
        .focus\:ring-green-500:focus, .focus\:ring-blue-500:focus, .focus\:ring-purple-500:focus, .focus\:ring-red-500:focus, .focus\:ring-yellow-500:focus {
            --tw-ring-color: #f59e0b !important;
        }

        /* æ¡ç”¨ index.html çš„æŸ”å’Œç¥ç€è‰²æ¼¸å±¤ä½œç‚ºèƒŒæ™¯ */
        .system-gradient-bg {
            background: linear-gradient(135deg, #f3e8d3 0%, #e8d5b7 100%);
        }
    </style>
</head>
<body class="system-gradient-bg min-h-screen">
    <!-- ç™»å…¥é é¢ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-4xl mb-4">ğŸ¥</div>
                <h1 id="loginTitle" class="text-2xl font-bold text-gray-800 mb-2">æ¹›å‡Œè¨ºæ‰€ç³»çµ±</h1>
                <p id="loginEnglishTitle" class="text-sm text-gray-500 mb-3">TCM Clinic</p>
                <p class="text-gray-600">è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶åŠå¯†ç¢¼ç™»å…¥</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">é›»å­éƒµä»¶</label>
                    <input type="email" id="mainLoginUsername" placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                           onkeypress="if(event.key==='Enter') document.getElementById('mainLoginPassword').focus()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å¯†ç¢¼</label>
                    <input type="password" id="mainLoginPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" 
                           class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                           onkeypress="if(event.key==='Enter') attemptMainLogin()">
                </div>
                
                <button onclick="attemptMainLogin()" 
                        class="w-full bg-amber-700 hover:bg-amber-800 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    ç™»å…¥ç³»çµ±
                </button>
                
                <!-- ç¤ºç¯„å¸³è™Ÿæç¤ºå€å·²ç§»é™¤ï¼Œç³»çµ±ä½¿ç”¨è€…è«‹ä½¿ç”¨æ‚¨çš„é›»å­éƒµä»¶ç™»å…¥ -->
            </div>
            <!-- ç™»å…¥é é¢ç‰ˆæ¬Šè²æ˜ -->
            <!--
                åœ¨ç™»å…¥é é¢çš„å¡ç‰‡åº•éƒ¨åŠ å…¥ç‰ˆæ¬Šè²æ˜ã€‚
                é€™æ®µç‰ˆæ¬Šè²æ˜ä»¥å°å­—é¡¯ç¤ºï¼Œä¸¦åœ¨ä¸Šæ–¹æ–°å¢ç´°ç·šä½œç‚ºå€éš”ã€‚
            -->
            <div class="text-center mt-8 text-xs text-gray-400">
                <div class="border-t border-gray-200 pt-4">
                    Copyright Â© 2025 <span class="text-gray-600 font-medium">æ¹›å‡Œæœ‰é™å…¬å¸</span>. All rights reserved.
                </div>
            </div>
        </div>
    </div>
    <!-- ä¸»ç³»çµ±é é¢ -->
    <div id="mainSystem" class="hidden fade-in">
        <!-- å´é‚Šé¸å–® -->
        <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 ease-in-out">
            <div class="flex flex-col h-full">
                <!-- é¸å–®æ¨™é¡Œ -->
                <div class="bg-green-600 text-white p-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">ğŸ¥</span>
                            <h2 class="text-lg font-bold">è¨ºæ‰€åŠŸèƒ½</h2>
                        </div>
                        <button onclick="toggleSidebar()" class="text-white hover:text-gray-200 text-xl">
                            Ã—
                        </button>
                    </div>
                    <div id="sidebarUserRole" class="text-sm text-green-100 mt-2"></div>
                </div>
                <!-- åŠŸèƒ½é¸å–®é …ç›® -->
                <div class="flex-1 py-4 overflow-y-auto">
                    <div id="sidebarMenu" class="space-y-2 px-4">
                        <!-- é¸å–®é …ç›®æœƒå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                <!-- åº•éƒ¨æ“ä½œ -->
                <div class="border-t border-gray-200 p-4">
                    <button onclick="logout()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm transition duration-200 flex items-center justify-center">
                        <span class="mr-2">ğŸšª</span>
                        ç™»å‡ºç³»çµ±
                    </button>
                </div>
            </div>
        </div>
        <!-- é®ç½©å±¤ -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleSidebar()"></div>
        <!-- é ‚éƒ¨å°èˆª -->
        <!-- ä»¥ index.html æ·±è‰²ç¥ç€é…è‰²å‘ˆç¾é ‚éƒ¨å°è¦½æ¢ï¼Œä¸¦ä¿æŒå›ºå®šåœ¨é ‚ç«¯ -->
        <nav class="bg-amber-900 text-amber-50 shadow-lg sticky top-0 z-50 border-b-4 border-amber-700">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <button onclick="toggleSidebar()" class="mr-4 p-2 rounded-lg hover:bg-gray-100 transition duration-200">
                            <div class="w-6 h-6 flex flex-col justify-center space-y-1">
                                <div class="w-full h-0.5 bg-gray-600"></div>
                                <div class="w-full h-0.5 bg-gray-600"></div>
                                <div class="w-full h-0.5 bg-gray-600"></div>
                            </div>
                        </button>
                        <span class="text-2xl mr-3">ğŸ¥</span>
                        <div>
                            <h1 id="systemTitle" class="text-xl font-bold text-amber-200">æ¹›å‡Œè¨ºæ‰€ç³»çµ±</h1>
                            <p id="systemEnglishTitle" class="text-xs text-amber-300">TCM Clinic</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="userRole" class="text-sm text-amber-200"></span>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition duration-200">
                            ç™»å‡º
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
        <div class="max-w-7xl mx-auto px-4 py-6">
            <!-- æ­¡è¿é é¢ -->
            <div id="welcomePage" class="text-center py-16">
                <div class="text-6xl mb-6">ğŸ¥</div>
                <h2 id="welcomeTitle" class="text-3xl font-bold text-gray-800 mb-2">æ­¡è¿ä½¿ç”¨æ¹›å‡Œè¨ºæ‰€ç³»çµ±</h2>
                <p id="welcomeEnglishTitle" class="text-lg text-gray-500 mb-4">Welcome to TCM Clinic</p>
                <p class="text-gray-600 text-lg mb-8">è«‹é»æ“Šå·¦ä¸Šè§’é¸å–®æŒ‰éˆ•é–‹å§‹ä½¿ç”¨ç³»çµ±åŠŸèƒ½</p>
                <div class="bg-white rounded-xl shadow-lg p-8 max-w-4xl mx-auto">
                    <h3 class="text-xl font-semibold mb-4">ç³»çµ±åŠŸèƒ½æ¦‚è¦½</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl mb-2">ğŸ‘¥</div>
                            <div class="font-semibold">ç—…äººè³‡æ–™ç®¡ç†</div>
                            <div class="text-gray-600 mt-1">æ–°å¢ã€æŸ¥çœ‹ã€ç®¡ç†ç—…äººè³‡æ–™</div>
                        </div>
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-2xl mb-2">ğŸ©º</div>
                            <div class="font-semibold">è¨ºç—‡ç³»çµ±</div>
                            <div class="text-gray-600 mt-1">è¨˜éŒ„ç—‡ç‹€ã€è¨ºæ–·ã€é–‹ç«‹è™•æ–¹</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-2xl mb-2">ğŸ‘¤</div>
                            <div class="font-semibold">ç”¨æˆ¶ç®¡ç†</div>
                            <div class="text-gray-600 mt-1">ç®¡ç†è¨ºæ‰€ç”¨æˆ¶æ¬Šé™</div>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="text-2xl mb-2">âš™ï¸</div>
                            <div class="font-semibold">ç³»çµ±ç®¡ç†</div>
                            <div class="text-gray-600 mt-1">çµ±è¨ˆè³‡æ–™ã€å‚™ä»½åŒ¯å‡º</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ç—…äººè³‡æ–™ç®¡ç† -->
            <div id="patientManagement" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">ç—…äººè³‡æ–™ç®¡ç†</h2>
                    <div class="flex flex-col md:flex-row gap-3">
                        <div class="relative">
                            <input type="text" id="searchPatient" placeholder="æœå°‹ç—…äººç·¨è™Ÿã€å§“åæˆ–é›»è©±..." class="border border-gray-300 rounded-lg px-4 py-2 pr-10 focus:ring-2 focus:ring-green-500 focus:border-transparent w-full md:w-64">
                            <span class="absolute right-3 top-2.5 text-gray-400">ğŸ”</span>
                        </div>
                        <button onclick="showAddPatientForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200 whitespace-nowrap">
                            + æ–°å¢ç—…äºº
                        </button>
                    </div>
                </div>
                <!-- æ–°å¢/ç·¨è¼¯ç—…äººè¡¨å–®å½ˆçª— -->
                <div id="addPatientModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="formTitle" class="text-xl font-bold text-gray-800">æ–°å¢ç—…äººè³‡æ–™</h3>
                            <button onclick="hideAddPatientForm()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å§“å *</label>
                                    <input type="text" id="patientName" placeholder="è«‹è¼¸å…¥å§“å" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å¹´é½¡</label>
                                    <input type="number" id="patientAge" placeholder="ç³»çµ±è‡ªå‹•è¨ˆç®—" min="0" max="120" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-100 text-gray-600">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æ€§åˆ¥ *</label>
                                    <select id="patientGender" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        <option value="">è«‹é¸æ“‡æ€§åˆ¥</option>
                                        <option value="ç”·">ç”·</option>
                                        <option value="å¥³">å¥³</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é›»è©±è™Ÿç¢¼ *</label>
                                    <input type="tel" id="patientPhone" placeholder="ä¾‹ï¼š0912-345-678" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <!-- å°‡èº«åˆ†è­‰å­—è™Ÿè¨­ç‚ºå¿…å¡«ï¼Œä¸¦ç§»é™¤å›ºå®šé•·åº¦é™åˆ¶ -->
                                    <label class="block text-sm font-medium text-gray-700 mb-1">èº«åˆ†è­‰å­—è™Ÿ *</label>
                                    <input type="text" id="patientIdCard" placeholder="ä¾‹ï¼šA123456789" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å‡ºç”Ÿæ—¥æœŸ *</label>
                                    <input type="date" id="patientBirthDate" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent" onchange="updatePatientAge()">
                                </div>
                                <div class="md:col-span-2 lg:col-span-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è¯çµ¡åœ°å€</label>
                                    <textarea id="patientAddress" placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€" rows="2" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent"></textarea>
                                </div>
                                <div class="md:col-span-2 lg:col-span-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">éæ•å²</label>
                                    <textarea id="patientAllergies" placeholder="è«‹è©³ç´°è¨˜éŒ„è—¥ç‰©éæ•æˆ–é£Ÿç‰©éæ•å²" rows="2" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent break-all"></textarea>
                                </div>
                                <div class="md:col-span-2 lg:col-span-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ç—…å²åŠå‚™è¨»</label>
                                    <textarea id="patientHistory" placeholder="è«‹è¨˜éŒ„é‡è¦ç—…å²ã€å®¶æ—ç—…å²ã€æ…¢æ€§ç–¾ç—…ç­‰" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent break-all"></textarea>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                                <button onclick="hideAddPatientForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="savePatient()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                    <span id="saveButtonText">å„²å­˜</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ç—…äººåˆ—è¡¨ -->
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç·¨è™Ÿ</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">å§“å</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">å¹´é½¡</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ€§åˆ¥</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">é›»è©±</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="patientList" class="divide-y divide-gray-200">
                            <!-- ç—…äººè³‡æ–™æœƒå‹•æ…‹è¼‰å…¥ -->
                        </tbody>
                    </table>
                </div>
                <!-- ç—…äººè©³ç´°è³‡æ–™å½ˆçª— -->
                <div id="patientDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                            <h3 class="text-xl font-bold text-gray-800">ç—…äººè©³ç´°è³‡æ–™</h3>
                            <button onclick="closePatientDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        <div id="patientDetailContent" class="p-6">
                            <!-- è©³ç´°å…§å®¹æœƒå‹•æ…‹è¼‰å…¥ -->
                        </div>
                    </div>
                </div>
                <!-- ç—…äººç—…æ­·æŸ¥çœ‹å½ˆçª— -->
                <div id="patientMedicalHistoryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="patientMedicalHistoryTitle" class="text-xl font-bold text-gray-800">ç—…æ­·è¨˜éŒ„</h3>
                            <button onclick="closePatientMedicalHistoryModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <!-- ç—…äººåŸºæœ¬è³‡è¨Š -->
                            <div id="patientMedicalHistoryPatientInfo" class="bg-blue-50 rounded-lg p-4 mb-6">
                                <!-- ç—…äººè³‡è¨Šæœƒå‹•æ…‹è¼‰å…¥ -->
                            </div>
                            
                            <!-- è¨ºç—‡è¨˜éŒ„åˆ—è¡¨ -->
                            <div id="patientMedicalHistoryContent">
                                <!-- è¨ºç—‡è¨˜éŒ„æœƒå‹•æ…‹è¼‰å…¥ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- è¨ºç—‡ç³»çµ± -->
            <div id="consultationSystem" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">æ›è™Ÿè¨ºç—‡ç³»çµ±</h2>
                    <p class="text-gray-600 mt-2">ç°¡æ½”çš„æ›è™Ÿæµç¨‹ç®¡ç†</p>
                </div>
                
                <!-- ç—…äººæœç´¢æ›è™Ÿ -->
                <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-6 mb-6">
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 flex items-center mb-2">
                            <span class="mr-2">ğŸ”</span>æœç´¢ç—…äººæ›è™Ÿ
                        </h3>
                        <p class="text-sm text-gray-600">è«‹è¼¸å…¥ç—…äººå§“åã€ç·¨è™Ÿæˆ–é›»è©±é€²è¡Œæœç´¢</p>
                    </div>
                    
                    <div class="flex gap-3">
                        <div class="flex-1 relative">
                            <input type="text" id="patientSearchInput" placeholder="æœå°‹ç—…äººå§“åã€ç·¨è™Ÿæˆ–é›»è©±..." 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 pr-10 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                   oninput="searchPatientsForRegistration()">
                            <span class="absolute right-3 top-3.5 text-gray-400">ğŸ”</span>
                        </div>
                        <button onclick="clearPatientSearch()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg transition duration-200">
                            æ¸…é™¤
                        </button>
                    </div>
                    
                    <!-- æœç´¢çµæœ -->
                    <div id="patientSearchResults" class="mt-4 hidden">
                        <div class="bg-white rounded-lg border border-gray-200 max-h-64 overflow-y-auto">
                            <div id="searchResultsList" class="divide-y divide-gray-200">
                                <!-- æœç´¢çµæœæœƒå‹•æ…‹è¼‰å…¥ -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æ›è™Ÿå½ˆçª— -->
                <div id="registrationModal" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                        <div class="bg-green-600 text-white px-6 py-4 rounded-t-xl">
                            <div class="flex justify-between items-center">
                                <h3 class="text-xl font-bold">ç—…äººæ›è™Ÿ</h3>
                                <button onclick="closeRegistrationModal()" class="text-white hover:text-gray-200 text-2xl">Ã—</button>
                            </div>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <!-- é¸ä¸­çš„ç—…äººè³‡è¨Š -->
                            <div class="bg-blue-50 rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <span class="mr-2">ğŸ‘¤</span>
                                    <span class="font-semibold text-gray-700">ç—…äººè³‡è¨Š</span>
                                </div>
                                <div id="selectedPatientInfo" class="text-sm text-gray-600">
                                    <!-- ç—…äººè³‡è¨Šæœƒå‹•æ…‹è¼‰å…¥ -->
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="mr-2">ğŸ‘¨â€âš•ï¸</span>æ›è™Ÿé†«å¸« *
                                </label>
                                <select id="appointmentDoctor" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <option value="">è«‹é¸æ“‡é†«å¸«</option>
                                    <!-- é†«å¸«é¸é …æœƒå‹•æ…‹è¼‰å…¥ -->
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="mr-2">â°</span>æ›è™Ÿæ™‚é–“
                                </label>
                                <input type="datetime-local" id="appointmentDateTime" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>

                            <!-- å•è¨ºè³‡æ–™é¸æ“‡ï¼šå…è¨±é†«å¸«æ–¼æ›è™Ÿæ™‚é¸æ“‡æ‚£è€…å…ˆå‰å¡«å¯«çš„å•è¨ºè³‡æ–™ -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="mr-2">ğŸ§¾</span>é¸æ“‡å•è¨ºè³‡æ–™
                                </label>
                                <select id="inquirySelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <option value="">ä¸ä½¿ç”¨å•è¨ºè³‡æ–™</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">è‹¥ç—…äººå·²å¡«å¯«å•è¨ºï¼Œå¯åœ¨æ­¤é¸æ“‡é å¡«è³‡è¨Š</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="mr-2">ğŸ“</span>ä¸»è¨´ç—‡ç‹€
                                </label>
                                <textarea id="quickChiefComplaint" placeholder="è«‹ç°¡è¿°ç—…äººçš„ä¸»è¦ç—‡ç‹€..." rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent"></textarea>
                            </div>
                            
                            <div class="flex space-x-3 pt-4">
                                <button onclick="closeRegistrationModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition duration-200">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="confirmRegistration()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition duration-200">
                                    ç¢ºèªæ›è™Ÿ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ä»Šæ—¥æ›è™Ÿåˆ—è¡¨ -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 rounded-t-lg">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <span class="mr-2">ğŸ“…</span>ä»Šæ—¥æ›è™Ÿåˆ—è¡¨
                            </h3>
                            <div class="text-sm text-gray-600 flex items-center space-x-3">
                                <!-- æ–°å¢æ›´æ–°æ›è™Ÿåˆ—è¡¨æŒ‰éˆ•ï¼šå‘¼å« loadTodayAppointments é‡æ–°è¼‰å…¥ç•¶æ—¥æ›è™Ÿè³‡æ–™ -->
                                <!-- æ›´æ–°æ›è™Ÿåˆ—è¡¨æŒ‰éˆ•è¨­è¨ˆç°¡æ½”ã€ä»¥ç™½è‰²ç‚ºä¸» -->
                                <!-- å°‡æ›´æ–°æ›è™Ÿåˆ—è¡¨æŒ‰éˆ•å°ºå¯¸èª¿æ•´ç‚ºè¼ƒå°ï¼šæ¸›å°‘å…§è·ã€é™ä½åœ“è§’ã€ä½¿ç”¨è¼ƒå°æ–‡å­— -->
                                <span>
                                    ç¸½è¨ˆï¼š<span id="todayTotal" class="font-semibold text-blue-600">0</span> äºº
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">åºè™Ÿ</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç—…äººå§“å</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ›è™Ÿé†«å¸«</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ›è™Ÿæ™‚é–“</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ä¸»è¨´ç—‡ç‹€</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç‹€æ…‹</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="todayAppointmentsList" class="divide-y divide-gray-200">
                                    <!-- æ›è™Ÿåˆ—è¡¨æœƒå‹•æ…‹è¼‰å…¥ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- è¨ºç—‡è¨˜éŒ„æŸ¥çœ‹å½ˆçª— -->
                <div id="medicalHistoryModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="medicalHistoryTitle" class="text-xl font-bold text-gray-800">è¨ºç—‡è¨˜éŒ„</h3>
                            <button onclick="closeMedicalHistoryModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <!-- ç—…äººåŸºæœ¬è³‡è¨Š -->
                            <div id="medicalHistoryPatientInfo" class="bg-blue-50 rounded-lg p-4 mb-6">
                                <!-- ç—…äººè³‡è¨Šæœƒå‹•æ…‹è¼‰å…¥ -->
                            </div>
                            
                            <!-- è¨ºç—‡è¨˜éŒ„åˆ—è¡¨ -->
                            <div id="medicalHistoryContent">
                                <!-- è¨ºç—‡è¨˜éŒ„æœƒå‹•æ…‹è¼‰å…¥ -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- è¨ºç—‡è¡¨å–®å€åŸŸ -->
                <div id="consultationForm" class="hidden bg-white border border-gray-200 rounded-lg mt-6">
                    <div class="bg-green-600 text-white px-6 py-4 rounded-t-lg">
                        <h3 class="text-xl font-bold">è¨ºç—‡è¨˜éŒ„</h3>
                    </div>
                    
                    <div class="p-6">
                        <!-- ç—…äººè³‡è¨Š -->
                        <div class="bg-blue-50 rounded-lg p-4 mb-6">
                            <!--
                              å°‡è¨ºç—‡è¡¨å–®ä¸­çš„ç—…äººåŸºæœ¬è³‡è¨Šå€åŸŸæ“´å……ï¼ŒåŠ å…¥å¹´é½¡ã€æ€§åˆ¥ã€éæ•å²ä»¥åŠç—…å²å‚™è¨»çš„é¡¯ç¤ºã€‚
                              å…¶ä¸­éæ•å²èˆ‡ç—…å²åœ¨ç„¡è³‡æ–™æ™‚æœƒéš±è—ï¼Œå…¶å®¹å™¨è¨­ç½®äº†å°æ‡‰çš„ ID ä¾› JavaScript æ§åˆ¶ã€‚
                            -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <span class="font-medium">ç—…äººï¼š</span>
                                    <span id="formPatientName" class="text-blue-600 font-semibold"></span>
                                </div>
                                <div>
                                    <span class="font-medium">å¹´é½¡ï¼š</span>
                                    <span id="formPatientAge"></span>
                                </div>
                                <div>
                                    <span class="font-medium">æ€§åˆ¥ï¼š</span>
                                    <span id="formPatientGender"></span>
                                </div>
                                <div>
                                    <span class="font-medium">æ›è™Ÿæ™‚é–“ï¼š</span>
                                    <span id="formAppointmentTime"></span>
                                </div>
                                <!-- ç—…å²åŠå‚™è¨»ï¼šè‹¥ç„¡è³‡æ–™å‰‡éš±è— -->
                                <div id="historyContainer" class="md:col-span-1 lg:col-span-2" style="display: none;">
                                    <span class="font-medium">ç—…å²åŠå‚™è¨»ï¼š</span>
                                    <span id="formPatientHistory" class="medical-field text-gray-700"></span>
                                </div>
                                <!-- éæ•å²ï¼šä»¥ç´…è‰²é«˜äº®é¡¯ç¤ºï¼Œè‹¥ç„¡è³‡æ–™å‰‡éš±è— -->
                                <div id="allergiesContainer" class="md:col-span-1 lg:col-span-2" style="display: none;">
                                    <span class="font-medium text-red-600">éæ•å²ï¼š</span>
                                    <span id="formPatientAllergies" class="medical-field text-red-700 bg-red-50 px-2 py-1 rounded"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- è¨ºç—‡è¡¨å–® -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- å·¦å´ -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        ä¸»è¨´ *
                                    </label>
                                    <textarea id="formSymptoms" placeholder="ç—…äººä¸»è¦ä¸é©ç—‡ç‹€ã€ç™¼ç—…æ™‚é–“ã€ç—‡ç‹€ç‰¹é»ç­‰..." rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>

                                <!-- ç¾ç—…å²æ¬„ä½ç§»è‡³ä¸»è¨´ä¸‹æ–¹ï¼Œä¸¦èª¿æ•´é«˜åº¦ç‚ºä¸»è¨´çš„å…©å€ -->
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        ç¾ç—…å²
                                    </label>
                                    <textarea id="formCurrentHistory" placeholder="ç™¼ç—…ç¶“éã€ç—‡ç‹€è®ŠåŒ–ã€æ²»ç™‚ç¶“éç­‰..." rows="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        èˆŒè±¡
                                    </label>
                                    <textarea id="formTongue" placeholder="èˆŒè³ªã€èˆŒè‹”ã€èˆŒå½¢ç­‰..." rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        è„ˆè±¡
                                    </label>
                                    <textarea id="formPulse" placeholder="è„ˆä½ã€è„ˆç‡ã€è„ˆåŠ›ã€è„ˆå½¢ç­‰..." rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        ä¸­é†«è¨ºæ–· *
                                    </label>
                                    <textarea id="formDiagnosis" placeholder="ä¸­é†«ç—…åè¨ºæ–·..." rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        è­‰å‹è¨ºæ–·
                                    </label>
                                    <textarea id="formSyndrome" placeholder="è¾¨è­‰åˆ†å‹ã€ç—…æ©Ÿåˆ†æ..." rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        é‡ç¸å‚™è¨»
                                    </label>
                                    <textarea id="formAcupunctureNotes" placeholder="é‡ç¸ç©´ä½ã€æ‰‹æ³•ã€æ³¨æ„äº‹é …ç­‰..." rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                            </div>

                            
                            <!-- å³å´ -->
                            <div class="space-y-4">
                                
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="block text-sm font-semibold text-gray-700">
                                            è™•æ–¹å…§å®¹
                                        </label>
                                        <button type="button" onclick="loadPreviousPrescription()" 
                                                class="text-xs bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded transition duration-200">
                                            ğŸ“‹ è¼‰å…¥ä¸Šæ¬¡è™•æ–¹
                                        </button>
                                    </div>
                                    
                                    <!-- ä¸­è—¥åº«æœç´¢å€åŸŸ -->
                                    <div class="mb-3 bg-yellow-50 rounded-lg p-3 border border-yellow-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-sm font-medium text-yellow-800 mr-2">ğŸ” æœç´¢ä¸­è—¥åº«ï¼š</span>
                                            <div class="flex-1 relative">
                                                <input type="text" id="prescriptionSearch" placeholder="æœç´¢ä¸­è—¥ææˆ–æ–¹åŠ‘åç¨±..." 
                                                       class="w-full border border-yellow-300 rounded px-3 py-1 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                                       oninput="searchHerbsForPrescription()">
                                                <button onclick="clearPrescriptionSearch()" class="absolute right-2 top-1 text-gray-400 hover:text-gray-600 text-sm">Ã—</button>
                                            </div>
                                        </div>
                                        
                                        <!-- æœç´¢çµæœ -->
                                        <div id="prescriptionSearchResults" class="hidden">
                                            <div class="bg-white rounded border border-yellow-200 max-h-48 overflow-y-auto">
                                                <div id="prescriptionSearchList" class="grid grid-cols-1 md:grid-cols-2 gap-2 p-2">
                                                    <!-- æœç´¢çµæœæœƒå‹•æ…‹è¼‰å…¥ -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- å·²é¸æ“‡çš„è™•æ–¹å…§å®¹ -->
                                    <div class="border border-gray-300 rounded-lg p-3 min-h-[120px] bg-gray-50">
                                        <div id="selectedPrescriptionItems" class="space-y-2">
                                            <div class="text-sm text-gray-500 text-center py-4">
                                                è«‹ä½¿ç”¨ä¸Šæ–¹æœç´¢åŠŸèƒ½æ·»åŠ ä¸­è—¥ææˆ–æ–¹åŠ‘
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- æœè—¥å¤©æ•¸åŠæ¬¡æ•¸è¨­å®šï¼ˆåªåœ¨æœ‰è™•æ–¹å…§å®¹æ™‚é¡¯ç¤ºï¼‰ -->
                                    <div id="medicationSettings" class="mt-3 bg-yellow-50 rounded-lg p-3 border border-yellow-200" style="display: none;">
                                        <div class="space-y-3">
                                            <!-- æœè—¥å¤©æ•¸ -->
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium text-yellow-800">æœè—¥å¤©æ•¸</span>
                                                <div class="flex items-center space-x-2">
                                                    <button onclick="updateMedicationDays(-1)" class="w-7 h-7 bg-yellow-500 text-white rounded-full text-sm hover:bg-yellow-600 transition duration-200">-</button>
                                                    <input type="number" id="medicationDays" value="5" min="1" max="30" 
                                                           class="w-14 px-2 py-1 text-center border border-yellow-300 rounded focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm"
                                                           onchange="updateMedicationDaysFromInput()" onclick="this.select()">
                                                    <button onclick="updateMedicationDays(1)" class="w-7 h-7 bg-yellow-500 text-white rounded-full text-sm hover:bg-yellow-600 transition duration-200">+</button>
                                                    <span class="text-sm text-yellow-800">å¤©</span>
                                                </div>
                                            </div>
                                            
                                            <!-- æœè—¥æ¬¡æ•¸ -->
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium text-yellow-800">æ¯æ—¥æ¬¡æ•¸</span>
                                                <div class="flex items-center space-x-2">
                                                    <button onclick="updateMedicationFrequency(-1)" class="w-7 h-7 bg-yellow-500 text-white rounded-full text-sm hover:bg-yellow-600 transition duration-200">-</button>
                                                    <input type="number" id="medicationFrequency" value="2" min="1" max="6" 
                                                           class="w-14 px-2 py-1 text-center border border-yellow-300 rounded focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm"
                                                           onchange="updateMedicationFrequency(0)" onclick="this.select()">
                                                    <button onclick="updateMedicationFrequency(1)" class="w-7 h-7 bg-yellow-500 text-white rounded-full text-sm hover:bg-yellow-600 transition duration-200">+</button>
                                                    <span class="text-sm text-yellow-800">æ¬¡/æ—¥</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- éš±è—çš„æ–‡æœ¬åŸŸç”¨æ–¼å­˜å„²è™•æ–¹å…§å®¹ -->
                                    <textarea id="formPrescription" class="hidden"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        æœç”¨æ–¹æ³•
                                    </label>
                                    <textarea id="formUsage" placeholder="ç…ç…®æ–¹æ³•ã€æœç”¨æ™‚é–“ã€åŠ‘é‡ç­‰..." rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="block text-sm font-semibold text-gray-700">
                                            æ”¶è²»é …ç›®
                                        </label>
                                        <button type="button" onclick="loadPreviousBillingItems()" 
                                                class="text-xs bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded transition duration-200">
                                            ğŸ’° è¼‰å…¥ä¸Šæ¬¡æ”¶è²»
                                        </button>
                                    </div>
                                    
                                    <!-- æ”¶è²»é …ç›®æœç´¢å€åŸŸ -->
                                    <div class="mb-3 bg-green-50 rounded-lg p-3 border border-green-200">
                                        <div class="flex items-center mb-2">
                                            <span class="text-sm font-medium text-green-800 mr-2">ğŸ’° é¸æ“‡æ”¶è²»é …ç›®ï¼š</span>
                                            <div class="flex-1 relative">
                                                <input type="text" id="billingSearch" placeholder="æœç´¢æ”¶è²»é …ç›®åç¨±..." 
                                                       class="w-full border border-green-300 rounded px-3 py-1 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                       oninput="searchBillingForConsultation()">
                                                <button onclick="clearBillingSearch()" class="absolute right-2 top-1 text-gray-400 hover:text-gray-600 text-sm">Ã—</button>
                                            </div>
                                        </div>
                                        
                                        <!-- æœç´¢çµæœ -->
                                        <div id="billingSearchResults" class="hidden">
                                            <div class="bg-white rounded border border-green-200 max-h-48 overflow-y-auto">
                                                <div id="billingSearchList" class="grid grid-cols-1 md:grid-cols-2 gap-2 p-2">
                                                    <!-- æœç´¢çµæœæœƒå‹•æ…‹è¼‰å…¥ -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- å·²é¸æ“‡çš„æ”¶è²»é …ç›® -->
                                    <div class="border border-gray-300 rounded-lg p-3 min-h-[80px] bg-gray-50">
                                        <div id="selectedBillingItems" class="space-y-2">
                                            <div class="text-sm text-gray-500 text-center py-4">
                                                è«‹ä½¿ç”¨ä¸Šæ–¹æœç´¢åŠŸèƒ½æ·»åŠ æ”¶è²»é …ç›®
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- ç¸½è²»ç”¨é¡¯ç¤º -->
                                    <div class="mt-2 text-right">
                                        <span class="text-sm font-medium text-gray-700">ç¸½è²»ç”¨ï¼š</span>
                                        <span id="totalBillingAmount" class="text-lg font-bold text-green-600">$0</span>
                                    </div>
                                    
                                    <!-- éš±è—çš„æ–‡æœ¬åŸŸç”¨æ–¼å­˜å„²æ”¶è²»é …ç›® -->
                                    <textarea id="formBillingItems" class="hidden"></textarea>
                                    <!-- ç—…äººå¥—ç¥¨ç®¡ç† -->
                                    <div class="mt-4 border border-purple-200 rounded-lg p-3 bg-purple-50">
                                      <div class="flex items-center justify-between mb-2">
                                        <div class="text-sm font-semibold text-purple-800">ğŸ« ç—…äººå¥—ç¥¨</div>
                                        <button type="button" onclick="refreshPatientPackagesUI()"
                                                class="text-xs px-2 py-1 bg-purple-600 text-white rounded">åˆ·æ–°</button>
                                      </div>
                                      <div id="patientPackagesList" class="space-y-2 text-sm text-gray-700">
                                        <!-- å‹•æ…‹è¼‰å…¥ -->
                                        <div class="text-gray-500">å°šæœªè¼‰å…¥æˆ–ç„¡å¥—ç¥¨</div>
                                      </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        ç™‚ç¨‹
                                    </label>
                                    <input type="text" id="formTreatmentCourse" placeholder="ä¾‹ï¼š7å¤©ã€2é€±ã€1å€‹æœˆç­‰..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        é†«å›‘åŠæ³¨æ„äº‹é …
                                    </label>
                                    <textarea id="formInstructions" placeholder="é£²é£Ÿå®œå¿Œã€ç”Ÿæ´»èª¿è­·ã€æ³¨æ„äº‹é …ç­‰..." rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- è¤‡è¨ºæ™‚é–“åŠå…¶ä»–æ™‚é–“è¨­å®š -->
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        è¤‡è¨ºæ™‚é–“
                                    </label>
                                    <input type="datetime-local" id="formFollowUpDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <p class="text-xs text-gray-500 mt-1">å»ºè­°ç—…äººä¸‹æ¬¡å›è¨ºçš„æ™‚é–“</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        åˆ°è¨ºæ™‚é–“
                                    </label>
                                    <input type="datetime-local" id="formVisitTime" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <p class="text-xs text-gray-500 mt-1">å¯¦éš›åˆ°è¨ºçš„æ™‚é–“ï¼ˆç”¨æ–¼è­‰æ˜æ›¸ï¼‰</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        å»ºè­°ä¼‘æ¯æœŸé–“
                                    </label>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2">
                                            <label class="text-xs text-gray-600 w-12">é–‹å§‹ï¼š</label>
                                            <input type="date" id="formRestStartDate" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" onchange="updateRestPeriod()">
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <label class="text-xs text-gray-600 w-12">çµæŸï¼š</label>
                                            <input type="date" id="formRestEndDate" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" onchange="updateRestPeriod()">
                                        </div>
                                        <div class="text-center">
                                            <span id="restPeriodDisplay" class="text-sm text-gray-500 font-medium">è«‹é¸æ“‡é–‹å§‹å’ŒçµæŸæ—¥æœŸ</span>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">ç”¨æ–¼ç—…å‡è­‰æ˜æ›¸çš„å»ºè­°ä¼‘æ¯æœŸé–“</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰éˆ• -->
                        <div class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200">
                            <button onclick="cancelConsultation()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                                å–æ¶ˆè¨ºç—‡
                            </button>
                            <button onclick="saveConsultation()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                <span id="consultationSaveButtonText">ä¿å­˜ç—…æ­·</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ä¸­è—¥åº«ç®¡ç† -->
            <div id="herbLibrary" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">ä¸­è—¥åº«ç®¡ç†</h2>
                    <div class="flex flex-col md:flex-row gap-3">
                        <div class="relative">
                            <input type="text" id="searchHerb" placeholder="æœå°‹ä¸­è—¥ææˆ–æ–¹åŠ‘åç¨±..." class="border border-gray-300 rounded-lg px-4 py-2 pr-10 focus:ring-2 focus:ring-green-500 focus:border-transparent w-full md:w-64">
                            <span class="absolute right-3 top-2.5 text-gray-400">ğŸ”</span>
                        </div>
                        <button onclick="showAddHerbForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200 whitespace-nowrap">
                            + æ–°å¢ä¸­è—¥æ
                        </button>
                        <button onclick="showAddFormulaForm()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200 whitespace-nowrap">
                            + æ–°å¢æ–¹åŠ‘
                        </button>
                    </div>
                </div>
                <!-- åˆ†é¡æ¨™ç±¤ -->
                <div class="mb-6">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterHerbLibrary('all')" id="filter-all" class="px-4 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-800 transition duration-200">
                            å…¨éƒ¨
                        </button>
                        <button onclick="filterHerbLibrary('herb')" id="filter-herb" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            ä¸­è—¥æ
                        </button>
                        <button onclick="filterHerbLibrary('formula')" id="filter-formula" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            æ–¹åŠ‘
                        </button>
                    </div>
                </div>
                <!-- æ–°å¢/ç·¨è¼¯ä¸­è—¥æè¡¨å–®å½ˆçª— -->
                <div id="addHerbModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="herbFormTitle" class="text-xl font-bold text-gray-800">æ–°å¢ä¸­è—¥æ</h3>
                            <button onclick="hideAddHerbForm()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ä¸­è—¥æåç¨± *</label>
                                    <input type="text" id="herbName" placeholder="è«‹è¼¸å…¥ä¸­è—¥æåç¨±" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">åˆ¥å</label>
                                    <input type="text" id="herbAlias" placeholder="å…¶ä»–åç¨±æˆ–åˆ¥å" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">åŠŸæ•ˆ</label>
                                    <textarea id="herbEffects" placeholder="è«‹æè¿°ä¸»è¦åŠŸæ•ˆ" rows="2" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å¸¸ç”¨åŠ‘é‡</label>
                                    <input type="text" id="herbDosage" placeholder="ä¾‹ï¼š3-9g" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ä½¿ç”¨æ³¨æ„</label>
                                    <input type="text" id="herbCautions" placeholder="ç¦å¿Œæˆ–æ³¨æ„äº‹é …" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                                <button onclick="hideAddHerbForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="saveHerb()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                    <span id="herbSaveButtonText">å„²å­˜</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æ–°å¢/ç·¨è¼¯æ–¹åŠ‘è¡¨å–®å½ˆçª— -->
                <div id="addFormulaModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="formulaFormTitle" class="text-xl font-bold text-gray-800">æ–°å¢æ–¹åŠ‘</h3>
                            <button onclick="hideAddFormulaForm()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">æ–¹åŠ‘åç¨± *</label>
                                        <input type="text" id="formulaName" placeholder="è«‹è¼¸å…¥æ–¹åŠ‘åç¨±" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">å‡ºè™•</label>
                                        <input type="text" id="formulaSource" placeholder="ä¾‹ï¼šå‚·å¯’è«–ã€é‡‘åŒ±è¦ç•¥" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">åŠŸæ•ˆ</label>
                                        <textarea id="formulaEffects" placeholder="è«‹æè¿°æ–¹åŠ‘ä¸»è¦åŠŸæ•ˆ" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">çµ„æˆ *</label>
                                        <textarea id="formulaComposition" placeholder="è«‹è¼¸å…¥æ–¹åŠ‘çµ„æˆï¼Œä¾‹å¦‚ï¼š&#10;äººåƒ&#10;ç™½æœ®&#10;èŒ¯è‹“&#10;ç”˜è‰" rows="8" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">æ³¨æ„äº‹é …</label>
                                        <textarea id="formulaCautions" placeholder="ç¦å¿Œã€æ³¨æ„äº‹é …ç­‰" rows="2" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                                <button onclick="hideAddFormulaForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="saveFormula()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                    <span id="formulaSaveButtonText">å„²å­˜</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ä¸­è—¥åº«åˆ—è¡¨ -->
                <div class="overflow-x-auto">
                    <div id="herbLibraryList" class="space-y-4">
                        <!-- ä¸­è—¥åº«å…§å®¹æœƒå‹•æ…‹è¼‰å…¥ -->
                    </div>
                </div>
            </div>
            <!-- æ”¶è²»é …ç›®ç®¡ç† -->
            <div id="billingManagement" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">æ”¶è²»é …ç›®ç®¡ç†</h2>
                    <div class="flex flex-col md:flex-row gap-3">
                        <div class="relative">
                            <input type="text" id="searchBilling" placeholder="æœå°‹æ”¶è²»é …ç›®åç¨±..." class="border border-gray-300 rounded-lg px-4 py-2 pr-10 focus:ring-2 focus:ring-green-500 focus:border-transparent w-full md:w-64">
                            <span class="absolute right-3 top-2.5 text-gray-400">ğŸ”</span>
                        </div>
                        <button onclick="showAddBillingItemForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200 whitespace-nowrap">
                            + æ–°å¢æ”¶è²»é …ç›®
                        </button>
                    </div>
                </div>
                <!-- åˆ†é¡æ¨™ç±¤ -->
                <div class="mb-6">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterBillingItems('all')" id="billing-filter-all" class="px-4 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-800 transition duration-200">
                            å…¨éƒ¨
                        </button>
                        <button onclick="filterBillingItems('consultation')" id="billing-filter-consultation" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            è¨ºç™‚è²»
                        </button>
                        <button onclick="filterBillingItems('medicine')" id="billing-filter-medicine" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            è—¥è²»
                        </button>
                        <button onclick="filterBillingItems('treatment')" id="billing-filter-treatment" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            æ²»ç™‚è²»
                        </button>
                        <button onclick="filterBillingItems('other')" id="billing-filter-other" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            å…¶ä»–
                        </button>
                        <button onclick="filterBillingItems('discount')" id="billing-filter-discount" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            æŠ˜æ‰£é …ç›®
                        </button>
                        <button onclick="filterBillingItems('package')" id="billing-filter-package" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            å¥—ç¥¨é …ç›®
                        </button>
                    </div>
                </div>
                <!-- æ–°å¢/ç·¨è¼¯æ”¶è²»é …ç›®è¡¨å–®å½ˆçª— -->
                <div id="addBillingItemModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="billingItemFormTitle" class="text-xl font-bold text-gray-800">æ–°å¢æ”¶è²»é …ç›®</h3>
                            <button onclick="hideAddBillingItemForm()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é …ç›®åç¨± *</label>
                                    <input type="text" id="billingItemName" placeholder="è«‹è¼¸å…¥æ”¶è²»é …ç›®åç¨±" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é …ç›®é¡åˆ¥ *</label>
                                    <select id="billingItemCategory" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        <option value="">è«‹é¸æ“‡é¡åˆ¥</option>
                                        <option value="consultation">è¨ºç™‚è²»</option>
                                        <option value="medicine">è—¥è²»</option>
                                        <option value="treatment">æ²»ç™‚è²»</option>
                                        <option value="other">å…¶ä»–</option>
                                        <option value="discount">æŠ˜æ‰£é …ç›®</option>
                                        <option value="package">å¥—ç¥¨é …ç›®</option>
                                    </select>
                                </div>
                                <!-- å¥—ç¥¨å°ˆç”¨æ¬„ä½ï¼šç•¶é¡åˆ¥é¸æ“‡ package æ™‚é¡¯ç¤º -->
                                <div id="packageFields" class="md:col-span-2 hidden">
                                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                      <label class="block text-sm font-medium text-gray-700 mb-1">å¥—ç¥¨å¯ç”¨æ¬¡æ•¸ *</label>
                                      <input type="number" id="billingItemPackageUses" placeholder="ä¾‹å¦‚ï¼š10" min="1"
                                             class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    </div>
                                    <div>
                                      <label class="block text-sm font-medium text-gray-700 mb-1">æœ‰æ•ˆå¤©æ•¸ *</label>
                                      <input type="number" id="billingItemValidityDays" placeholder="ä¾‹å¦‚ï¼š180ï¼ˆåŠå¹´ï¼‰" min="1"
                                             class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                      <p class="text-xs text-gray-500 mt-1">è‡ªè³¼è²·æ—¥èµ·ç®—</p>
                                    </div>
                                  </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æ”¶è²»é‡‘é¡ *</label>
                                    <input type="number" id="billingItemPrice" placeholder="0" step="1" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <p class="text-xs text-gray-500 mt-1">æŠ˜æ‰£é …ç›®ï¼šè¼¸å…¥0.9è¡¨ç¤º9æŠ˜ï¼Œè¼¸å…¥9æœƒè‡ªå‹•è½‰ç‚º9æŠ˜ï¼Œæˆ–è¼¸å…¥è² æ•¸è¡¨ç¤ºå›ºå®šé‡‘é¡æŠ˜æ‰£</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è¨ˆè²»å–®ä½</label>
                                    <input type="text" id="billingItemUnit" placeholder="ä¾‹ï¼šæ¬¡ã€åŠ‘ã€åŒ…" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é …ç›®èªªæ˜</label>
                                    <textarea id="billingItemDescription" placeholder="è«‹æè¿°æ”¶è²»é …ç›®çš„è©³ç´°å…§å®¹" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent"></textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="billingItemActive" checked class="mr-2 rounded">
                                        <span class="text-sm font-medium text-gray-700">å•Ÿç”¨æ­¤æ”¶è²»é …ç›®</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                                <button onclick="hideAddBillingItemForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="saveBillingItem()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                    <span id="billingItemSaveButtonText">å„²å­˜</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- æ”¶è²»é …ç›®åˆ—è¡¨ -->
                <div class="overflow-x-auto">
                    <div id="billingItemsList" class="space-y-4">
                        <!-- æ”¶è²»é …ç›®å…§å®¹æœƒå‹•æ…‹è¼‰å…¥ -->
                    </div>
                </div>
            </div>
            <!-- è¨ºæ‰€ç”¨æˆ¶ç®¡ç† -->
            <div id="userManagement" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">è¨ºæ‰€ç”¨æˆ¶ç®¡ç†</h2>
                    <div class="flex flex-col md:flex-row gap-3">
                        <div class="relative">
                            <input type="text" id="searchUser" placeholder="æœå°‹ç”¨æˆ¶åç¨±æˆ–é›»å­éƒµä»¶..." class="border border-gray-300 rounded-lg px-4 py-2 pr-10 focus:ring-2 focus:ring-green-500 focus:border-transparent w-full md:w-64">
                            <span class="absolute right-3 top-2.5 text-gray-400">ğŸ”</span>
                        </div>
                        <button onclick="showAddUserForm()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200 whitespace-nowrap">
                            + æ–°å¢ç”¨æˆ¶
                        </button>
                    </div>
                </div>
                <!-- ç‹€æ…‹ç¯©é¸æ¨™ç±¤ -->
                <div class="mb-6">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterUsers('all')" id="user-filter-all" class="px-4 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-800 transition duration-200">
                            å…¨éƒ¨ç”¨æˆ¶
                        </button>
                        <button onclick="filterUsers('inactive')" id="user-filter-inactive" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition duration-200">
                            å·²åœç”¨
                        </button>
                    </div>
                </div>
                <!-- æ–°å¢/ç·¨è¼¯ç”¨æˆ¶è¡¨å–®å½ˆçª— -->
                <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                            <h3 id="userFormTitle" class="text-xl font-bold text-gray-800">æ–°å¢ç”¨æˆ¶</h3>
                            <button onclick="hideAddUserForm()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
                        </div>
                        
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- å¸³è™Ÿèˆ‡å¯†ç¢¼æ¬„ä½å·²ç§»é™¤ï¼Œç³»çµ±å°‡è‡ªå‹•ä½¿ç”¨ Firebase UID æˆ–é›»å­éƒµä»¶ç”¢ç”Ÿè­˜åˆ¥åç¨± -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">å§“å *</label>
                                    <input type="text" id="userDisplayName" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è·ä½ *</label>
                                    <select id="userPosition" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent" onchange="toggleRegistrationNumberField()">
                                        <option value="">è«‹é¸æ“‡è·ä½</option>
                                        <option value="è¨ºæ‰€ç®¡ç†">è¨ºæ‰€ç®¡ç†</option>
                                        <option value="é†«å¸«">é†«å¸«</option>
                                        <option value="è­·ç†å¸«">è­·ç†å¸«</option>
        <option value="ç”¨æˆ¶">ä¸€èˆ¬ç”¨æˆ¶</option>
                                    </select>
                                </div>
                                <div id="registrationNumberField" class="hidden">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ä¸­é†«è¨»å†Šç·¨è™Ÿ *</label>
                                    <input type="text" id="userRegistrationNumber" placeholder="è«‹è¼¸å…¥ä¸­é†«è¨»å†Šç·¨è™Ÿ" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <p class="text-xs text-gray-500 mt-1">é†«å¸«è·ä½å¿…é ˆå¡«å¯«è¨»å†Šç·¨è™Ÿ</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é›»å­éƒµä»¶</label>
                                    <input type="email" id="userEmail" placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é›»è©±è™Ÿç¢¼</label>
                                    <input type="tel" id="userPhone" placeholder="è«‹è¼¸å…¥é›»è©±è™Ÿç¢¼" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <!-- Firebase UID æ¬„ä½ -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Firebase UID</label>
                                    <input type="text" id="userUID" placeholder="è«‹è¼¸å…¥ Firebase UIDï¼ˆå¯ä¸å¡«ï¼‰" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <p class="text-xs text-gray-500 mt-1">å°æ‡‰ Firebase Authentication å¸³è™Ÿçš„ UID</p>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="userActive" checked class="mr-2 rounded">
                                        <span class="text-sm font-medium text-gray-700">å•Ÿç”¨æ­¤ç”¨æˆ¶å¸³è™Ÿ</span>
                                    </label>
                                    <p class="text-xs text-gray-500 mt-1">åœç”¨çš„å¸³è™Ÿå°‡ç„¡æ³•ç™»å…¥ç³»çµ±</p>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                                <button onclick="hideAddUserForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                                    å–æ¶ˆ
                                </button>
                                <button onclick="saveUser()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200">
                                    <span id="userSaveButtonText">å„²å­˜</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ç”¨æˆ¶åˆ—è¡¨ -->
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">å§“å</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">è·ä½</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">è¨»å†Šç·¨è™Ÿ</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">é›»å­éƒµä»¶</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ç‹€æ…‹</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æœ€å¾Œç™»å…¥</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="userList" class="divide-y divide-gray-200">
                            <!-- ç”¨æˆ¶è³‡æ–™æœƒå‹•æ…‹è¼‰å…¥ -->
                        </tbody>
                    </table>
                </div>
            </div>
<!-- è²¡å‹™å ±è¡¨ -->
            <div id="financialReports" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                        <span class="mr-3">ğŸ“Š</span>è²¡å‹™å ±è¡¨
                    </h2>
                    <p class="text-gray-600">è¨ºæ‰€æ”¶å…¥åˆ†æèˆ‡è²¡å‹™çµ±è¨ˆ</p>
                </div>
                <!-- ç¯©é¸æ§åˆ¶å€ -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å ±è¡¨é¡å‹</label>
                            <select id="reportType" onchange="generateFinancialReport()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="daily">æ—¥å ±è¡¨</option>
                                <option value="weekly">é€±å ±è¡¨</option>
                                <option value="monthly" selected>æœˆå ±è¡¨</option>
                                <option value="yearly">å¹´å ±è¡¨</option>
                                <option value="custom">è‡ªè¨‚æœŸé–“</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å¿«é€Ÿé¸æ“‡</label>
                            <select id="quickDate" onchange="setQuickDate()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="">è«‹é¸æ“‡...</option>
                                <option value="today">ä»Šå¤©</option>
                                <option value="yesterday">æ˜¨å¤©</option>
                                <option value="thisWeek">æœ¬é€±</option>
                                <option value="lastWeek">ä¸Šé€±</option>
                                <option value="thisMonth">æœ¬æœˆ</option>
                                <option value="lastMonth">ä¸Šæœˆ</option>
                                <option value="thisYear">ä»Šå¹´</option>
                                <option value="lastYear">å»å¹´</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é–‹å§‹æ—¥æœŸ</label>
                            <input type="date" id="startDate" onchange="generateFinancialReport()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">çµæŸæ—¥æœŸ</label>
                            <input type="date" id="endDate" onchange="generateFinancialReport()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é†«å¸«ç¯©é¸</label>
                            <select id="doctorFilter" onchange="generateFinancialReport()" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="">å…¨éƒ¨é†«å¸«</option>
                            </select>
                        </div>
                        
                        <div class="flex items-end space-x-2">
                            <button onclick="generateFinancialReport()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200 flex items-center">
                                <span class="mr-2">ğŸ”„</span>æ›´æ–°å ±è¡¨
                            </button>
                            <button onclick="exportFinancialReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition duration-200 flex items-center">
                                <span class="mr-2">ğŸ“¥</span>åŒ¯å‡º
                            </button>
                        </div>
                    </div>
                </div>
                <!-- é—œéµæŒ‡æ¨™å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-green-400 to-green-600 text-white rounded-xl p-6 shadow-lg transform hover:scale-105 transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm font-medium">ç¸½æ”¶å…¥</p>
                                <h3 id="totalRevenue" class="text-3xl font-bold">$0</h3>
                                <p id="revenueChange" class="text-green-100 text-sm mt-1">çµ±è¨ˆæœŸé–“æ”¶å…¥</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <span class="text-2xl">ğŸ’°</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-xl p-6 shadow-lg transform hover:scale-105 transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm font-medium">è¨ºç—‡äººæ¬¡</p>
                                <h3 id="totalConsultations" class="text-3xl font-bold">0</h3>
                                <p id="consultationChange" class="text-blue-100 text-sm mt-1">å®Œæˆè¨ºç—‡æ¬¡æ•¸</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <span class="text-2xl">ğŸ‘¥</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-400 to-purple-600 text-white rounded-xl p-6 shadow-lg transform hover:scale-105 transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm font-medium">å¹³å‡æ¶ˆè²»</p>
                                <h3 id="averageRevenue" class="text-3xl font-bold">$0</h3>
                                <p id="averageChange" class="text-purple-100 text-sm mt-1">æ¯æ¬¡è¨ºç—‡å¹³å‡</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <span class="text-2xl">ğŸ“Š</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-orange-400 to-orange-600 text-white rounded-xl p-6 shadow-lg transform hover:scale-105 transition duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-orange-100 text-sm font-medium">æ´»èºé†«å¸«</p>
                                <h3 id="activeDoctors" class="text-3xl font-bold">0</h3>
                                <p id="doctorChange" class="text-orange-100 text-sm mt-1">æœ‰è¨ºç—‡çš„é†«å¸«</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-3">
                                <span class="text-2xl">ğŸ‘¨â€âš•ï¸</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- è©³ç´°å ±è¡¨ -->
                <div class="bg-white border border-gray-200 rounded-lg">
                    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 rounded-t-lg">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <span class="mr-2">ğŸ“‹</span>è©³ç´°è²¡å‹™å ±è¡¨
                            </h3>
                            <div class="text-sm text-gray-600">
                                è³‡æ–™æ›´æ–°æ™‚é–“ï¼š<span id="lastUpdateTime">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ¨™ç±¤é  -->
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6" role="tablist">
                            <button onclick="switchFinancialTab('summary')" id="financialSummaryTab" class="py-4 px-1 border-b-2 border-green-500 text-green-600 font-medium text-sm transition duration-200">
                                æ”¶å…¥æ‘˜è¦
                            </button>
                            <button onclick="switchFinancialTab('daily')" id="financialDailyTab" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm transition duration-200">
                                æ¯æ—¥æ˜ç´°
                            </button>
                            <button onclick="switchFinancialTab('doctor')" id="financialDoctorTab" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm transition duration-200">
                                é†«å¸«æ¥­ç¸¾
                            </button>
                            <button onclick="switchFinancialTab('service')" id="financialServiceTab" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm transition duration-200">
                                æœå‹™åˆ†æ
                            </button>
                        </nav>
                    </div>
                    
                    <!-- æ¨™ç±¤å…§å®¹ -->
                    <div class="p-6">
                        <!-- æ”¶å…¥æ‘˜è¦æ¨™ç±¤ -->
                        <div id="financialSummaryContent" class="financial-tab-content">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">é …ç›®</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">é‡‘é¡</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">ä½”æ¯”</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">å‚™è¨»</th>
                                        </tr>
                                    </thead>
                                    <tbody id="financialSummaryTableBody" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                                                è«‹é»æ“Šã€Œæ›´æ–°å ±è¡¨ã€ä¾†è¼‰å…¥è³‡æ–™
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- æ¯æ—¥æ˜ç´°æ¨™ç±¤ -->
                        <div id="financialDailyContent" class="financial-tab-content hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æ—¥æœŸ</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">è¨ºç—‡äººæ¬¡</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">æ”¶å…¥é‡‘é¡</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">å¹³å‡æ¶ˆè²»</th>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ä¸»è¦æœå‹™</th>
                                        </tr>
                                    </thead>
                                    <tbody id="financialDailyTableBody" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                                è«‹é»æ“Šã€Œæ›´æ–°å ±è¡¨ã€ä¾†è¼‰å…¥è³‡æ–™
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- é†«å¸«æ¥­ç¸¾æ¨™ç±¤ -->
                        <div id="financialDoctorContent" class="financial-tab-content hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">é†«å¸«</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">è¨ºç—‡äººæ¬¡</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">ç¸½æ”¶å…¥</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">å¹³å‡æ¶ˆè²»</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">ä½”æ¯”</th>
                                        </tr>
                                    </thead>
                                    <tbody id="financialDoctorTableBody" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                                è«‹é»æ“Šã€Œæ›´æ–°å ±è¡¨ã€ä¾†è¼‰å…¥è³‡æ–™
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- æœå‹™åˆ†ææ¨™ç±¤ -->
                        <div id="financialServiceContent" class="financial-tab-content hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">æœå‹™é¡å‹</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">æ¬¡æ•¸</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">ç¸½é‡‘é¡</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">å¹³å‡å–®åƒ¹</th>
                                            <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">æ”¶å…¥ä½”æ¯”</th>
                                        </tr>
                                    </thead>
                                    <tbody id="financialServiceTableBody" class="divide-y divide-gray-200">
                                        <tr>
                                            <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                                è«‹é»æ“Šã€Œæ›´æ–°å ±è¡¨ã€ä¾†è¼‰å…¥è³‡æ–™
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ç³»çµ±ç®¡ç† -->
            <div id="systemManagement" class="hidden bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ç³»çµ±ç®¡ç†</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

<div class="bg-gray-50 rounded-lg p-6">
    <h3 class="text-lg font-semibold mb-4">è³‡æ–™å‚™ä»½èˆ‡é‚„åŸ</h3>
    <p class="text-sm text-gray-600 mb-4">æ‚¨å¯ä»¥åŒ¯å‡ºè¨ºæ‰€è³‡æ–™å‚™ä»½ï¼Œæˆ–åŒ¯å…¥ä¹‹å‰çš„å‚™ä»½æª”æ¡ˆã€‚å¯¦æ™‚æ›è™Ÿè³‡æ–™ä¸åŒ…å«åœ¨å‚™ä»½ä¸­ã€‚</p>
    <div class="flex flex-col md:flex-row gap-4">
        <button id="backupExportBtn" onclick="exportClinicBackup()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition duration-200">
            åŒ¯å‡ºå‚™ä»½
        </button>
        <button id="backupImportBtn" onclick="triggerBackupImport()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition duration-200">
            åŒ¯å…¥å‚™ä»½
        </button>
        <input type="file" id="backupFileInput" accept=".json" class="hidden" onchange="handleBackupFile(this.files[0])">
    </div>
</div>
                                
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">è¨ºæ‰€è¨­å®š</h3>
                        <div class="space-y-3">
                            <div class="text-center py-4" id="clinicSettingsDisplay">
                                <div class="text-sm text-gray-700 mb-3">
                                    <div class="font-medium">è¨ºæ‰€ä¸­æ–‡åç¨±ï¼š<span id="displayChineseName">æ¹›å‡Œè¨ºæ‰€ç³»çµ±</span></div>
                                    <div class="text-gray-600 mt-1">è¨ºæ‰€è‹±æ–‡åç¨±ï¼š<span id="displayEnglishName">TCM Clinic</span></div>
                                </div>
                                <button onclick="showClinicSettingsModal()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition duration-200">
                                    è¨ºæ‰€è³‡æ–™ä¿®æ”¹
                                </button>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <!-- ä¸»ç³»çµ±é é¢ç‰ˆæ¬Šè²æ˜ -->
        <!-- åœ¨ä¸»ç³»çµ±é é¢çµå°¾åŠ å…¥ç‰ˆæ¬Šè²æ˜ï¼Œç½®æ–¼ä¸»è¦å…§å®¹å®¹å™¨èˆ‡ä¸»ç³»çµ±å¤–å±¤ä¹‹é–“ã€‚ -->
        <div class="max-w-7xl mx-auto px-4 py-4 mt-8">
            <div class="text-center border-t border-gray-200 pt-4">
                <div class="text-xs text-gray-400">
                    Copyright Â© 2025 <span class="text-gray-500 font-medium">æ¹›å‡Œæœ‰é™å…¬å¸</span>. All rights reserved.
                </div>
            </div>
        </div>
    </div>
    <!-- è¨ºæ‰€è³‡æ–™ä¿®æ”¹å½ˆçª— -->
    <div id="clinicSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-xl">
                <h3 class="text-xl font-bold text-gray-800">è¨ºæ‰€è³‡æ–™ä¿®æ”¹</h3>
                <button onclick="hideClinicSettingsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">Ã—</button>
            </div>
            
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è¨ºæ‰€ä¸­æ–‡åç¨± *</label>
                        <input type="text" id="clinicChineseName" placeholder="è«‹è¼¸å…¥è¨ºæ‰€ä¸­æ–‡åç¨±" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è¨ºæ‰€è‹±æ–‡åç¨±</label>
                        <input type="text" id="clinicEnglishName" placeholder="è«‹è¼¸å…¥è¨ºæ‰€è‹±æ–‡åç¨±" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è¨ºæ‰€ç‡Ÿæ¥­æ™‚é–“</label>
                        <input type="text" id="clinicBusinessHours" placeholder="ä¾‹ï¼šé€±ä¸€è‡³é€±äº” 09:00-18:00" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è¨ºæ‰€é›»è©±</label>
                        <input type="tel" id="clinicPhone" placeholder="è«‹è¼¸å…¥è¨ºæ‰€é›»è©±è™Ÿç¢¼" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è¨ºæ‰€åœ°å€</label>
                        <textarea id="clinicAddress" placeholder="è«‹è¼¸å…¥è¨ºæ‰€å®Œæ•´åœ°å€" rows="3" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200">
                    <button onclick="hideClinicSettingsModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition duration-200">
                        å–æ¶ˆ
                    </button>
                    <button onclick="saveClinicSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition duration-200">
                        å„²å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="system.js"></script>
    <script src="system.js"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"96f142c32d05b42b","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.8.0","token":"b2074e7888b746fe9fbbc15492b4c3d4"}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"97172fa8b875b31b","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.8.0","token":"b2074e7888b746fe9fbbc15492b4c3d4"}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
