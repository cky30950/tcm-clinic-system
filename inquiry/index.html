<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>預先問診系統</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        section {
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
        }
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .options label {
            font-weight: normal;
            margin-right: 15px;
            display: flex;
            align-items: center;
        }
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .color-option {
            width: 40px;
            height: 40px;
            border: 2px solid transparent;
            cursor: pointer;
            border-radius: 4px;
        }
        .color-option.selected {
            border-color: #000;
        }
        .body-map-container {
            position: relative;
            max-width: 300px;
            margin: 10px auto;
        }
        .body-map-container img {
            width: 100%;
            display: block;
        }
        .marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: red;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        .toggle-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .toggle-buttons button {
            padding: 5px 15px;
            border: 1px solid #ccc;
            background-color: #e6e6e6;
            cursor: pointer;
            border-radius: 4px;
        }
        .toggle-buttons button.active {
            background-color: #007bff;
            color: white;
        }
        .submit-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>預先問診系統</h1>
        <form id="surveyForm">
            <!-- Gender -->
            <section id="genderSection">
                <label>性別：</label>
                <div class="options">
                    <label><input type="radio" name="gender" value="男" required> 男</label>
                    <label><input type="radio" name="gender" value="女"> 女</label>
                </div>
            </section>
            <!-- Main complaint -->
            <section id="chiefComplaintSection">
                <label for="chiefComplaint">主訴：主要有什麼不舒服？</label>
                <textarea id="chiefComplaint" name="chiefComplaint" rows="3" placeholder="請輸入..." required></textarea>
            </section>
            <!-- Pain location -->
            <section id="painLocationSection">
                <label>疼痛或不舒服部位（點選身體圖，可跳過）：</label>
                <div class="toggle-buttons">
                    <button type="button" id="painFrontBtn" class="active">正面</button>
                    <button type="button" id="painBackBtn">背面</button>
                </div>
        <div class="body-map-container" id="painBodyContainer">
                    <img id="painBodyImage" src="" alt="body front">
                    <!-- Marker for pain location -->
                    <div id="painMarker" class="marker" style="display:none;"></div>
                </div>
                <input type="hidden" id="painOrientation" name="painOrientation" value="front">
                <input type="hidden" id="painX" name="painX">
                <input type="hidden" id="painY" name="painY">
            </section>
            <!-- Basic symptoms -->
            <section id="basicSymptomSection">
                <label>基礎問題：</label>
                <div class="options">
                    <label><input type="checkbox" name="basic[]" value="口苦"> 口苦</label>
                    <label><input type="checkbox" name="basic[]" value="口干"> 口干</label>
                    <label><input type="checkbox" name="basic[]" value="眼乾"> 眼乾</label>
                    <label><input type="checkbox" name="basic[]" value="耳鳴"> 耳嗚</label>
                    <label><input type="checkbox" name="basic[]" value="頭暈"> 頭暈</label>
                    <label><input type="checkbox" name="basic[]" value="心慌心悸"> 心慌心悸</label>
                    <label><input type="checkbox" name="basic[]" value="心煩"> 心煩</label>
                    <label><input type="checkbox" name="basic[]" value="情緒緊張"> 情緒緊張</label>
                </div>
            </section>
        <!-- Sweating -->
            <section id="sweatSection">
                <label>汗出：</label>
                <div class="options">
                    <label><input type="checkbox" name="sweat[]" value="容易出汗"> 容易出汗</label>
                    <label><input type="checkbox" name="sweat[]" value="半夜盜汗"> 半夜盜汗</label>
                    <label><input type="checkbox" name="sweat[]" value="不出汗的身體"> 不出汗的身體</label>
                    <label><input type="checkbox" name="sweat[]" value="時常流汗不止"> 時常流汗不止 (請於下方標記)</label>
                </div>
                <!-- Sweating location map -->
                <div class="toggle-buttons">
                    <button type="button" id="sweatFrontBtn" class="active">正面</button>
                    <button type="button" id="sweatBackBtn">背面</button>
                </div>
                <div class="body-map-container" id="sweatBodyContainer">
                    <img id="sweatBodyImage" src="" alt="body front">
                    <div id="sweatMarker" class="marker" style="display:none;"></div>
                </div>
                <input type="hidden" id="sweatOrientation" name="sweatOrientation" value="front">
                <input type="hidden" id="sweatX" name="sweatX">
                <input type="hidden" id="sweatY" name="sweatY">
            </section>
            <!-- Cold and Hot -->
            <section id="coldHotSection">
                <label>寒熱：</label>
                <div class="options">
                    <label><input type="radio" name="coldhot" value="多怕冷"> 多怕冷</label>
                    <label><input type="radio" name="coldhot" value="多怕熱"> 多怕熱</label>
                    <label><input type="radio" name="coldhot" value="怕冷又怕熱"> 怕冷又怕熱</label>
                    <label><input type="radio" name="coldhot" value="不怕冷不怕熱"> 不怕冷不怕熱</label>
                    <label><input type="radio" name="coldhot" value="寒熱交替"> 寒熱交替</label>
                    <label><input type="radio" name="coldhot" value="多怕風"> 多怕風</label>
                    <label><input type="radio" name="coldhot" value="手腳冰冷"> 手腳冰冷</label>
                </div>
            </section>
            <!-- Appetite -->
            <section id="appetiteSection">
                <label>胃口：</label>
                <div class="options">
                    <label><input type="checkbox" name="appetite[]" value="食欲较差"> 食欲較差</label>
                    <label><input type="checkbox" name="appetite[]" value="食欲旺盛"> 食欲旺盛</label>
                    <label><input type="checkbox" name="appetite[]" value="食欲正常"> 食欲正常</label>
                    <label><input type="checkbox" name="appetite[]" value="容易餓"> 容易餓</label>
                    <label><input type="checkbox" name="appetite[]" value="喜歡吃什麼口味的食物"> 喜歡吃什麼口味的食物</label>
                    <label><input type="checkbox" name="appetite[]" value="喜飲冷"> 喜飲冷</label>
                    <label><input type="checkbox" name="appetite[]" value="容易肚脹"> 容易肚脹</label>
                    <label><input type="checkbox" name="appetite[]" value="容易脹氣多"> 容易脹氣多</label>
                    <label><input type="checkbox" name="appetite[]" value="反酸"> 反酸</label>
                    <label><input type="checkbox" name="appetite[]" value="容易嘔吐"> 容易嘔吐</label>
                </div>
            </section>
            <!-- Drinking water -->
            <section id="drinkSection">
                <label>飲水：</label>
                <div class="options">
                    <label><input type="checkbox" name="drink[]" value="喜温热"> 喜溫熱</label>
                    <label><input type="checkbox" name="drink[]" value="喜冷凉"> 喜冷涼</label>
                    <label><input type="checkbox" name="drink[]" value="均可"> 均可</label>
                    <label><input type="checkbox" name="drink[]" value="渴飲"> 渴飲</label>
                    <label><input type="checkbox" name="drink[]" value="不渴飲"> 不渴飲</label>
                    <label><input type="checkbox" name="drink[]" value="時常會忘記喝水"> 時常會忘記喝水</label>
                    <label><input type="checkbox" name="drink[]" value="怎麼喝也不能止渴"> 怎麼喝也不能止渴</label>
                </div>
            </section>
            <!-- Urination -->
            <section id="urineSection">
                <label>小便：</label>
                <div class="options">
                    <label><input type="checkbox" name="urine[]" value="清長"> 清長</label>
                    <label><input type="checkbox" name="urine[]" value="短赤"> 短赤</label>
                    <label><input type="checkbox" name="urine[]" value="易急"> 易急</label>
                    <label><input type="checkbox" name="urine[]" value="小便痛"> 小便痛</label>
                    <label><input type="checkbox" name="urine[]" value="小便難去"> 小便難去</label>
                    <label><input type="checkbox" name="urine[]" value="小便緩慢量少"> 小便緩慢量少</label>
                    <label><input type="checkbox" name="urine[]" value="尿頻"> 尿頻</label>
                    <label><input type="checkbox" name="urine[]" value="沒有尿意"> 沒有尿意</label>
                </div>
                <label for="nightUrine">夜尿多少次：</label>
                <input type="number" id="nightUrine" name="nightUrine" min="0" placeholder="次數 (可空)" />
                <label for="urineTimes">平均一天幾次：</label>
                <input type="number" id="urineTimes" name="urineTimes" min="0" placeholder="次數 (可空)" />
                <label>小便顏色：</label>
                <div class="color-palette" id="urineColors"></div>
                <input type="hidden" name="urineColor" id="urineColor">
            </section>
            <!-- Defecation -->
            <section id="defecationSection">
                <label>大便：</label>
                <div class="options">
                    <label><input type="checkbox" name="stool[]" value="成形"> 成形</label>
                    <label><input type="checkbox" name="stool[]" value="不成形"> 不成形</label>
                    <label><input type="checkbox" name="stool[]" value="干燥結塊"> 干燥結塊</label>
                    <label><input type="checkbox" name="stool[]" value="便秘"> 便秘</label>
                    <label><input type="checkbox" name="stool[]" value="容易腹瀉"> 容易腹瀉</label>
                    <label><input type="checkbox" name="stool[]" value="去完大便仍想去"> 去完大便仍想去</label>
                </div>
                <label for="stoolFrequency">大便多少日一次：</label>
                <input type="number" id="stoolFrequency" name="stoolFrequency" min="0" placeholder="天數 (可空)" />
                <label>大便味道：</label>
                <div class="options">
                    <label><input type="radio" name="stoolOdor" value="很臭"> 很臭</label>
                    <label><input type="radio" name="stoolOdor" value="無味"> 無味</label>
                </div>
                <label>大便顏色：</label>
                <div class="color-palette" id="stoolColors"></div>
                <input type="hidden" name="stoolColor" id="stoolColor">
            </section>
            <!-- Sleep -->
            <section id="sleepSection">
                <label>睡眠：</label>
                <div class="options">
                    <label><input type="checkbox" name="sleep[]" value="失眠"> 失眠</label>
                    <label><input type="checkbox" name="sleep[]" value="睡眠淺"> 睡眠淺</label>
                    <label><input type="checkbox" name="sleep[]" value="多夢"> 多夢</label>
                    <label><input type="checkbox" name="sleep[]" value="正常"> 正常</label>
                    <label><input type="checkbox" name="sleep[]" value="一覺到天亮"> 一覺到天亮</label>
                </div>
            </section>
            <!-- Energy -->
            <section id="energySection">
                <label>體力：</label>
                <div class="options">
                    <label><input type="checkbox" name="energy[]" value="精神好"> 精神好</label>
                    <label><input type="checkbox" name="energy[]" value="一直疲憊"> 一直疲憊</label>
                    <label><input type="checkbox" name="energy[]" value="早上起床精神奕奕"> 早上起床精神奕奕</label>
                    <label><input type="checkbox" name="energy[]" value="精神能集中"> 精神能集中</label>
                </div>
            </section>
            <!-- Past medical history -->
            <section id="historySection">
                <label>病史 (可跳過)：</label>
                <div class="options">
                    <label><input type="checkbox" name="history[]" value="高血糖"> 高血糖</label>
                    <label><input type="checkbox" name="history[]" value="高膽固醇"> 高膽固醇</label>
                    <label><input type="checkbox" name="history[]" value="高血壓"> 高血壓</label>
                    <label><input type="checkbox" name="history[]" value="慢性胃炎"> 慢性胃炎</label>
                </div>
            </section>
            <!-- Current Western medication -->
            <section id="medicationSection">
                <label>正在服的西藥 (可跳過)：</label>
                <div class="options">
                    <label><input type="checkbox" name="medication[]" value="胃藥"> 胃藥</label>
                    <label><input type="checkbox" name="medication[]" value="血壓藥"> 血壓藥</label>
                    <label><input type="checkbox" name="medication[]" value="血糖藥"> 血糖藥</label>
                    <label><input type="checkbox" name="medication[]" value="降膽固醇藥"> 降膽固醇藥</label>
                </div>
            </section>
            <!-- Allergies -->
            <section id="allergySection">
                <label>過敏史 (可跳過)：</label>
                <div class="options">
                    <label><input type="checkbox" name="allergy[]" value="中藥過敏"> 中藥過敏</label>
                    <label><input type="checkbox" name="allergy[]" value="G6PD"> G6PD</label>
                    <label><input type="checkbox" name="allergy[]" value="懷孕"> 懷孕</label>
                </div>
            </section>
            <!-- Submit -->
            <section>
                <button type="submit" class="submit-btn">提交問診</button>
            </section>
        </form>
    </div>
    <script>
        // Assign initial src for images when DOM is ready
        // Load color palettes
        const urineColors = [
            { hex: '#F5F5DC', label: '淺米色' },
            { hex: '#FFFFCC', label: '淺黃' },
            { hex: '#FFF176', label: '亮黃' },
            { hex: '#FFD700', label: '金黃' },
            { hex: '#FFA500', label: '橙黃' },
            { hex: '#FF8C00', label: '深橙' },
            { hex: '#D2691E', label: '茶色' },
            { hex: '#8B4513', label: '深褐' }
        ];
        const stoolColors = [
            { hex: '#F5DEB3', label: '淺褐' },
            { hex: '#D2B48C', label: '黃褐' },
            { hex: '#A0522D', label: '中褐' },
            { hex: '#8B4513', label: '深褐' },
            { hex: '#654321', label: '更深褐' },
            { hex: '#808000', label: '橄欖綠' },
            { hex: '#228B22', label: '綠色' },
            { hex: '#000000', label: '黑色' },
            { hex: '#B22222', label: '紅色' }
        ];
        function renderPalette(containerId, colors, hiddenInputId) {
            const container = document.getElementById(containerId);
            colors.forEach(({ hex, label }) => {
                const div = document.createElement('div');
                div.className = 'color-option';
                div.style.backgroundColor = hex;
                div.title = label;
                div.dataset.color = hex;
                div.addEventListener('click', () => {
                    // deselect all
                    container.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                    div.classList.add('selected');
                    document.getElementById(hiddenInputId).value = hex;
                });
                container.appendChild(div);
            });
        }
        // Render color palettes on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial image sources to local files
            document.getElementById('painBodyImage').src = 'body_front.png';
            document.getElementById('sweatBodyImage').src = 'body_front.png';
            renderPalette('urineColors', urineColors, 'urineColor');
            renderPalette('stoolColors', stoolColors, 'stoolColor');
        });
        // Body image toggles for pain
        const painFrontBtn = document.getElementById('painFrontBtn');
        const painBackBtn = document.getElementById('painBackBtn');
        const painBodyImage = document.getElementById('painBodyImage');
        const painMarker = document.getElementById('painMarker');
        const painOrientation = document.getElementById('painOrientation');
        painFrontBtn.addEventListener('click', () => {
            painBodyImage.src = 'body_front.png';
            painOrientation.value = 'front';
            painFrontBtn.classList.add('active');
            painBackBtn.classList.remove('active');
        });
        painBackBtn.addEventListener('click', () => {
            painBodyImage.src = 'body_back.png';
            painOrientation.value = 'back';
            painBackBtn.classList.add('active');
            painFrontBtn.classList.remove('active');
        });
        painBodyImage.addEventListener('click', (e) => {
            const rect = painBodyImage.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width).toFixed(3);
            const y = ((e.clientY - rect.top) / rect.height).toFixed(3);
            document.getElementById('painX').value = x;
            document.getElementById('painY').value = y;
            // Position marker
            painMarker.style.left = (x * 100) + '%';
            painMarker.style.top = (y * 100) + '%';
            painMarker.style.display = 'block';
        });
        // Body image toggles for sweating
        const sweatFrontBtn = document.getElementById('sweatFrontBtn');
        const sweatBackBtn = document.getElementById('sweatBackBtn');
        const sweatBodyImage = document.getElementById('sweatBodyImage');
        const sweatMarker = document.getElementById('sweatMarker');
        const sweatOrientation = document.getElementById('sweatOrientation');
        sweatFrontBtn.addEventListener('click', () => {
            sweatBodyImage.src = 'body_front.png';
            sweatOrientation.value = 'front';
            sweatFrontBtn.classList.add('active');
            sweatBackBtn.classList.remove('active');
        });
        sweatBackBtn.addEventListener('click', () => {
            sweatBodyImage.src = 'body_back.png';
            sweatOrientation.value = 'back';
            sweatBackBtn.classList.add('active');
            sweatFrontBtn.classList.remove('active');
        });
        sweatBodyImage.addEventListener('click', (e) => {
            const rect = sweatBodyImage.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width).toFixed(3);
            const y = ((e.clientY - rect.top) / rect.height).toFixed(3);
            document.getElementById('sweatX').value = x;
            document.getElementById('sweatY').value = y;
            // Position marker
            sweatMarker.style.left = (x * 100) + '%';
            sweatMarker.style.top = (y * 100) + '%';
            sweatMarker.style.display = 'block';
        });
        // Form submit handler
        document.getElementById('surveyForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            // Convert FormData to JSON-like object
            const obj = {};
            formData.forEach((value, key) => {
                if (obj[key]) {
                    if (Array.isArray(obj[key])) {
                        obj[key].push(value);
                    } else {
                        obj[key] = [obj[key], value];
                    }
                } else {
                    obj[key] = value;
                }
            });
            console.log('表單資料：', obj);
            alert('已提交問診，謝謝！');
            // Reset form after submission
            this.reset();
            // Clear markers and selections
            painMarker.style.display = 'none';
            sweatMarker.style.display = 'none';
            document.getElementById('urineColor').value = '';
            document.getElementById('stoolColor').value = '';
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
        });
    </script>
</body>
</html>