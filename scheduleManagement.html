<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²éšé†«ç™‚æ’ç­ç®¡ç†ç³»çµ±</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0 0 20px 0;
            color: #2d3748;
            font-size: 28px;
            font-weight: 700;
        }



        .filter-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #4299e1;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }

        .quick-btn.danger {
            background: #f56565;
        }

        .quick-btn.danger:hover {
            background: #e53e3e;
        }

        .quick-btn.success {
            background: #48bb78;
        }

        .quick-btn.success:hover {
            background: #38a169;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .current-date {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            margin: 0 20px;
        }

        .view-controls {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: #48bb78;
            color: white;
        }

        .view-btn:hover {
            transform: translateY(-2px);
        }

        .sync-controls {
            display: flex;
            gap: 10px;
        }

        .sync-btn {
            background: #805ad5;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sync-btn:hover {
            background: #6b46c1;
            transform: translateY(-2px);
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .calendar-grid {
            display: grid;
            gap: 1px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .month-view {
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: auto repeat(6, 1fr);
        }





        .calendar-header {
            background: #4a5568;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 700;
            font-size: 14px;
        }

        .time-slot {
            background: #f7fafc;
            padding: 8px;
            font-size: 12px;
            color: #718096;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #e2e8f0;
        }

        .calendar-cell {
            background: white;
            padding: 8px;
            min-height: 80px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .calendar-cell:hover {
            background: #f0fff4;
        }

        .calendar-cell.other-month {
            background: #f8f9fa;
            color: #adb5bd;
        }

        .calendar-cell.today {
            background: #e6fffa;
            border: 2px solid #38b2ac;
        }

        .day-number {
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .shift-item {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 4px 6px;
            border-radius: 6px;
            font-size: 10px;
            margin: 1px 0;
            cursor: move;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 3px solid rgba(255,255,255,0.3);
            word-wrap: break-word;
            line-height: 1.2;
        }

        .shift-item:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .shift-item.doctor {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .shift-item.nurse {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        .shift-item.emergency {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            animation: pulse 2s infinite;
        }

        .shift-item.overtime {
            background: linear-gradient(135deg, #9f7aea, #805ad5);
            border-left-color: #ffd700;
        }

        .shift-item.dragging {
            opacity: 0.7;
            transform: rotate(5deg) scale(1.1);
            z-index: 1000;
        }

        .shift-item .shift-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
        }

        .shift-item .shift-name {
            font-weight: 600;
            font-size: 10px;
        }

        .shift-item .shift-actions {
            display: flex;
            gap: 2px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .shift-item:hover .shift-actions {
            opacity: 1;
        }

        .shift-action-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .shift-action-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .shift-details {
            font-size: 8px;
            opacity: 0.9;
            line-height: 1.1;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .drop-zone {
            border: 2px dashed #4299e1;
            background: rgba(66, 153, 225, 0.1);
        }

        .staff-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .staff-panel h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .staff-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .staff-card {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 8px;
            padding: 8px 12px;
            border: 2px solid transparent;
            cursor: grab;
            transition: all 0.3s ease;
            min-width: 80px;
            max-width: 120px;
            position: relative;
            overflow: hidden;
            user-select: none;
            text-align: center;
        }

        .staff-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: rgba(66, 153, 225, 0.3);
        }

        .staff-card:active {
            cursor: grabbing;
        }

        .staff-card.dragging {
            opacity: 0.8;
            transform: rotate(5deg) scale(1.05);
            z-index: 1000;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .staff-card.doctor {
            border-left: 4px solid #48bb78;
            background: linear-gradient(135deg, #f0fff4, #e6fffa);
        }

        .staff-card.doctor:hover {
            border-color: #48bb78;
            background: linear-gradient(135deg, #e6fffa, #c6f6d5);
        }

        .staff-card.nurse {
            border-left: 4px solid #ed8936;
            background: linear-gradient(135deg, #fffaf0, #fef5e7);
        }

        .staff-card.nurse:hover {
            border-color: #ed8936;
            background: linear-gradient(135deg, #fef5e7, #fed7aa);
        }



        .staff-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .staff-status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2px;
            font-size: 9px;
            color: #68d391;
            font-weight: 500;
        }

        .staff-status.busy {
            color: #f56565;
        }

        .staff-status.partial {
            color: #ed8936;
        }

        .drag-hint {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 10px;
            color: #cbd5e0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .staff-card:hover .drag-hint {
            opacity: 1;
        }



        .staff-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .staff-filter-btn {
            background: #e2e8f0;
            border: none;
            color: #4a5568;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .staff-filter-btn.active {
            background: #4299e1;
            color: white;
        }

        .staff-filter-btn:hover {
            transform: translateY(-1px);
        }

        .drop-target {
            border: 2px dashed #4299e1 !important;
            background: rgba(66, 153, 225, 0.1) !important;
        }

        .drop-target::after {
            content: 'æ”¾é–‹ä»¥æ–°å¢æ’ç­';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #4299e1;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            pointer-events: none;
            z-index: 10;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #4299e1;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }



        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-controls, .view-controls, .sync-controls {
                justify-content: center;
            }

            .current-date {
                margin: 10px 0;
                text-align: center;
            }

            .calendar-grid.month-view {
                grid-template-columns: repeat(7, 1fr);
                font-size: 12px;
            }

            .calendar-cell {
                min-height: 60px;
                padding: 4px;
            }

            .shift-item {
                font-size: 10px;
                padding: 2px 4px;
            }


        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ é€²éšé†«ç™‚æ’ç­ç®¡ç†ç³»çµ±</h1>

            <div class="controls">
                <div class="nav-controls">
                    <button class="nav-btn" onclick="navigateCalendar(-1)">â—€ ä¸Šä¸€å€‹</button>
                    <div class="current-date" id="currentDate"></div>
                    <button class="nav-btn" onclick="navigateCalendar(1)">ä¸‹ä¸€å€‹ â–¶</button>
                    <button class="nav-btn" onclick="goToToday()">ğŸ“… ä»Šå¤©</button>
                </div>
                <div class="view-controls">
                    <button class="view-btn active">æœˆè¦–åœ–</button>
                </div>
                <div class="sync-controls">
                    <button class="sync-btn" onclick="syncToGoogle()">ğŸ“… åŒæ­¥ Google</button>
                    <button class="sync-btn" onclick="exportToICal()">ğŸ“‹ åŒ¯å‡º iCal</button>
                    <button class="sync-btn" onclick="printSchedule()">ğŸ–¨ï¸ åˆ—å°</button>
                </div>
            </div>
        </div>

        <!-- ç¯©é¸é¢æ¿ -->
        <div class="filter-panel">
            <div class="filter-grid">
                <div class="filter-group">
                    <label class="filter-label">éƒ¨é–€ç¯©é¸</label>
                    <select class="filter-select" id="departmentFilter" onchange="applyFilters()">
                        <option value="">æ‰€æœ‰éƒ¨é–€</option>
                        <option value="å…§ç§‘">å…§ç§‘</option>
                        <option value="å¤–ç§‘">å¤–ç§‘</option>
                        <option value="æ€¥è¨ºç§‘">æ€¥è¨ºç§‘</option>
                        <option value="å…’ç§‘">å…’ç§‘</option>
                        <option value="å©¦ç”¢ç§‘">å©¦ç”¢ç§‘</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">è·ä½ç¯©é¸</label>
                    <select class="filter-select" id="roleFilter" onchange="applyFilters()">
                        <option value="">æ‰€æœ‰è·ä½</option>
                        <option value="doctor">é†«å¸«</option>
                        <option value="nurse">è­·ç†å¸«</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">ç­åˆ¥ç¯©é¸</label>
                    <select class="filter-select" id="shiftTypeFilter" onchange="applyFilters()">
                        <option value="">æ‰€æœ‰ç­åˆ¥</option>
                        <option value="morning">æ—©ç­</option>
                        <option value="afternoon">ä¸­ç­</option>
                        <option value="night">å¤œç­</option>
                        <option value="emergency">æ€¥è¨º</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">æœå°‹äººå“¡</label>
                    <input type="text" class="filter-input" id="staffSearch" placeholder="è¼¸å…¥å§“å..." oninput="applyFilters()">
                </div>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="openFixedScheduleModal()">ğŸ“… å›ºå®šä¸Šç­</button>
                    <button class="quick-btn" onclick="checkConflicts()">âš ï¸ æª¢æŸ¥è¡çª</button>
                    <button class="quick-btn danger" onclick="clearAllShifts()">ğŸ—‘ï¸ æ¸…ç©ºæ’ç­</button>
                </div>
            </div>
        </div>



        <div class="calendar-container">
            <div class="calendar-grid month-view" id="calendarGrid"></div>
        </div>

        <div class="staff-panel">
            <h3>ğŸ‘¨â€âš•ï¸ğŸ‘©â€âš•ï¸ é†«è­·äººå“¡ç®¡ç† <span style="font-size: 12px; color: #718096; font-weight: normal;">æ‹–æ‹½äººå“¡åˆ°è¡Œäº‹æ›†æ–°å¢æ’ç­</span></h3>
            <div class="staff-filter">
                <button class="staff-filter-btn active" onclick="filterStaff('all')">å…¨éƒ¨</button>
                <button class="staff-filter-btn" onclick="filterStaff('doctor')">é†«å¸«</button>
                <button class="staff-filter-btn" onclick="filterStaff('nurse')">è­·ç†å¸«</button>

            </div>
            <div class="staff-grid" id="staffGrid"></div>
        </div>
    </div>

    <!-- æ–°å¢æ’ç­æ¨¡æ…‹æ¡† -->
    <div class="modal" id="shiftModal">
        <div class="modal-content">
            <h3>æ–°å¢æ’ç­</h3>
            <form id="shiftForm">
                <div class="form-group">
                    <label class="form-label">äººå“¡</label>
                    <select class="form-select" id="staffSelect" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ—¥æœŸ</label>
                    <input type="date" class="form-input" id="shiftDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">é–‹å§‹æ™‚é–“</label>
                    <input type="time" class="form-input" id="startTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">çµæŸæ™‚é–“</label>
                    <input type="time" class="form-input" id="endTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ç­åˆ¥</label>
                    <select class="form-select" id="shiftType" required>
                        <option value="morning">æ—©ç­ (08:00-16:00)</option>
                        <option value="afternoon">ä¸­ç­ (16:00-24:00)</option>
                        <option value="night">å¤œç­ (00:00-08:00)</option>
                        <option value="emergency">æ€¥è¨ºç­</option>
                        <option value="custom">è‡ªè¨‚æ™‚é–“</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">å‚™è¨»</label>
                    <input type="text" class="form-input" id="shiftNotes" placeholder="è¼¸å…¥å‚™è¨»è³‡è¨Š...">
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">æ–°å¢æ’ç­</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å›ºå®šä¸Šç­æ¨¡æ…‹æ¡† -->
    <div class="modal" id="fixedScheduleModal">
        <div class="modal-content">
            <h3>è¨­å®šå›ºå®šä¸Šç­æ™‚é–“</h3>
            <form id="fixedScheduleForm">
                <div class="form-group">
                    <label class="form-label">é¸æ“‡äººå“¡</label>
                    <select class="form-select" id="fixedStaffSelect" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">å›ºå®šç­åˆ¥</label>
                    <select class="form-select" id="fixedShiftType" required>
                        <option value="morning">æ—©ç­ (08:00-16:00)</option>
                        <option value="afternoon">ä¸­ç­ (16:00-24:00)</option>
                        <option value="night">å¤œç­ (00:00-08:00)</option>
                        <option value="custom">è‡ªè¨‚æ™‚é–“</option>
                    </select>
                </div>
                <div class="form-group" id="customTimeGroup" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label">é–‹å§‹æ™‚é–“</label>
                            <input type="time" class="form-input" id="fixedStartTime">
                        </div>
                        <div>
                            <label class="form-label">çµæŸæ™‚é–“</label>
                            <input type="time" class="form-input" id="fixedEndTime">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">å·¥ä½œæ—¥é¸æ“‡</label>
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day0" value="0"> æ—¥
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day1" value="1" checked> ä¸€
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day2" value="2" checked> äºŒ
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day3" value="3" checked> ä¸‰
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day4" value="4" checked> å››
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day5" value="5" checked> äº”
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                            <input type="checkbox" id="day6" value="6"> å…­
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æ‡‰ç”¨ç¯„åœ</label>
                    <select class="form-select" id="scheduleRange" required>
                        <option value="current-month">æœ¬æœˆä»½</option>
                        <option value="next-month">ä¸‹å€‹æœˆ</option>
                        <option value="current-and-next">æœ¬æœˆåŠä¸‹å€‹æœˆ</option>
                        <option value="custom-range">è‡ªè¨‚æ—¥æœŸç¯„åœ</option>
                    </select>
                </div>
                <div class="form-group" id="customRangeGroup" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label class="form-label">é–‹å§‹æ—¥æœŸ</label>
                            <input type="date" class="form-input" id="rangeStartDate">
                        </div>
                        <div>
                            <label class="form-label">çµæŸæ—¥æœŸ</label>
                            <input type="date" class="form-input" id="rangeEndDate">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">å‚™è¨»</label>
                    <input type="text" class="form-input" id="fixedScheduleNotes" placeholder="å›ºå®šä¸Šç­æ’ç¨‹" value="å›ºå®šä¸Šç­æ’ç¨‹">
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #4a5568;">
                        <input type="checkbox" id="replaceExisting" checked>
                        è¦†è“‹ç¾æœ‰æ’ç­ï¼ˆå¦‚æœæœ‰è¡çªï¼‰
                    </label>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeFixedScheduleModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">å»ºç«‹å›ºå®šæ’ç­</button>
                </div>
            </form>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification"></div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentDate = new Date();
        let currentView = 'month';
        let draggedShift = null;
        let currentStaffFilter = 'all';
        
        // é†«è­·äººå“¡è³‡æ–™
        const staff = [
            { id: 1, name: 'ç‹å¿—æ˜', role: 'doctor', department: 'å…§ç§‘', level: 'ä¸»æ²»é†«å¸«', phone: '0912-345-678', email: 'wang@hospital.com', maxHours: 40 },
            { id: 2, name: 'æç¾ç²', role: 'doctor', department: 'å¤–ç§‘', level: 'ä½é™¢é†«å¸«', phone: '0923-456-789', email: 'li@hospital.com', maxHours: 36 },
            { id: 3, name: 'å¼µå»ºåœ‹', role: 'doctor', department: 'æ€¥è¨ºç§‘', level: 'ä¸»æ²»é†«å¸«', phone: '0934-567-890', email: 'zhang@hospital.com', maxHours: 42 },
            { id: 4, name: 'é™³æ·‘èŠ¬', role: 'nurse', department: 'å…§ç§‘', level: 'è­·ç†å¸«', phone: '0945-678-901', email: 'chen@hospital.com', maxHours: 40 },
            { id: 5, name: 'æ—é›…å©·', role: 'nurse', department: 'å¤–ç§‘', level: 'è³‡æ·±è­·ç†å¸«', phone: '0956-789-012', email: 'lin@hospital.com', maxHours: 38 },
            { id: 6, name: 'é»ƒå¿—è¯', role: 'nurse', department: 'æ€¥è¨ºç§‘', level: 'è­·ç†å¸«', phone: '0967-890-123', email: 'huang@hospital.com', maxHours: 44 },
            { id: 7, name: 'åŠ‰ä½³æ…§', role: 'doctor', department: 'å…’ç§‘', level: 'ä¸»æ²»é†«å¸«', phone: '0978-901-234', email: 'liu@hospital.com', maxHours: 36 },
            { id: 8, name: 'å³æ˜ç ', role: 'nurse', department: 'å…’ç§‘', level: 'è­·ç†å¸«', phone: '0989-012-345', email: 'wu@hospital.com', maxHours: 40 },
            { id: 9, name: 'è”¡æ–‡é›„', role: 'doctor', department: 'å©¦ç”¢ç§‘', level: 'ä¸»æ²»é†«å¸«', phone: '0990-123-456', email: 'tsai@hospital.com', maxHours: 38 },
            { id: 10, name: 'é„­éº—è¯', role: 'nurse', department: 'å©¦ç”¢ç§‘', level: 'è³‡æ·±è­·ç†å¸«', phone: '0901-234-567', email: 'zheng@hospital.com', maxHours: 36 }
        ];

        // æ’ç­è³‡æ–™ - ä½¿ç”¨ç•¶å‰æœˆä»½çš„æ—¥æœŸ
        let shifts = [];
        
        // åˆå§‹åŒ–ä¸€äº›ç¤ºç¯„æ’ç­è³‡æ–™
        function initializeSampleShifts() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // ç¢ºä¿ä½¿ç”¨ä¸€è‡´çš„æ—¥æœŸï¼Œé¿å…è¦–åœ–é–“ä¸åŒæ­¥
            const baseDate = 26; // çµ±ä¸€ä½¿ç”¨26è™Ÿä½œç‚ºç¤ºç¯„æ—¥æœŸ
            
            shifts = [
                { id: 1, staffId: 1, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${baseDate.toString().padStart(2, '0')}`, startTime: '08:00', endTime: '16:00', type: 'morning', status: 'confirmed', notes: 'é–€è¨º' },
                { id: 2, staffId: 4, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${baseDate.toString().padStart(2, '0')}`, startTime: '08:00', endTime: '16:00', type: 'morning', status: 'confirmed', notes: 'ç—…æˆ¿' },
                { id: 3, staffId: 2, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${(baseDate + 1).toString().padStart(2, '0')}`, startTime: '16:00', endTime: '24:00', type: 'afternoon', status: 'pending', notes: 'æ‰‹è¡“æˆ¿' },
                { id: 4, staffId: 5, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${(baseDate + 1).toString().padStart(2, '0')}`, startTime: '16:00', endTime: '24:00', type: 'afternoon', status: 'confirmed', notes: 'ç—…æˆ¿' },
                { id: 5, staffId: 3, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${(baseDate + 2).toString().padStart(2, '0')}`, startTime: '00:00', endTime: '08:00', type: 'night', status: 'confirmed', notes: 'æ€¥è¨º' },
                { id: 6, staffId: 6, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${(baseDate + 2).toString().padStart(2, '0')}`, startTime: '00:00', endTime: '08:00', type: 'night', status: 'confirmed', notes: 'æ€¥è¨º' },
                { id: 7, staffId: 7, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${(baseDate - 1).toString().padStart(2, '0')}`, startTime: '09:00', endTime: '17:00', type: 'morning', status: 'confirmed', notes: 'å…’ç§‘é–€è¨º' },
                { id: 8, staffId: 8, date: `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${(baseDate - 1).toString().padStart(2, '0')}`, startTime: '09:00', endTime: '17:00', type: 'morning', status: 'confirmed', notes: 'å…’ç§‘ç—…æˆ¿' }
            ];
        }

        // ç¯©é¸ç‹€æ…‹
        let currentFilters = {
            department: '',
            role: '',
            shiftType: '',
            staffSearch: ''
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleShifts(); // è¼‰å…¥ç¤ºç¯„æ’ç­è³‡æ–™
            updateCurrentDate();
            renderCalendar();
            renderStaffPanel();
            setupEventListeners();
            updateStats();
        });

        // è¨­å®šäº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // ç­åˆ¥é¸æ“‡è®Šæ›´
            document.getElementById('shiftType').addEventListener('change', function() {
                const type = this.value;
                const startTime = document.getElementById('startTime');
                const endTime = document.getElementById('endTime');
                
                switch(type) {
                    case 'morning':
                        startTime.value = '08:00';
                        endTime.value = '16:00';
                        break;
                    case 'afternoon':
                        startTime.value = '16:00';
                        endTime.value = '24:00';
                        break;
                    case 'night':
                        startTime.value = '00:00';
                        endTime.value = '08:00';
                        break;
                }
            });

            // å›ºå®šæ’ç­ç­åˆ¥é¸æ“‡è®Šæ›´
            document.getElementById('fixedShiftType').addEventListener('change', function() {
                const type = this.value;
                const customTimeGroup = document.getElementById('customTimeGroup');
                const startTime = document.getElementById('fixedStartTime');
                const endTime = document.getElementById('fixedEndTime');
                
                if (type === 'custom') {
                    customTimeGroup.style.display = 'block';
                } else {
                    customTimeGroup.style.display = 'none';
                    switch(type) {
                        case 'morning':
                            startTime.value = '08:00';
                            endTime.value = '16:00';
                            break;
                        case 'afternoon':
                            startTime.value = '16:00';
                            endTime.value = '24:00';
                            break;
                        case 'night':
                            startTime.value = '00:00';
                            endTime.value = '08:00';
                            break;
                    }
                }
            });

            // æ’ç¨‹ç¯„åœé¸æ“‡è®Šæ›´
            document.getElementById('scheduleRange').addEventListener('change', function() {
                const customRangeGroup = document.getElementById('customRangeGroup');
                if (this.value === 'custom-range') {
                    customRangeGroup.style.display = 'block';
                } else {
                    customRangeGroup.style.display = 'none';
                }
            });

            // è¡¨å–®æäº¤
            document.getElementById('shiftForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addShift();
            });

            // å›ºå®šæ’ç­è¡¨å–®æäº¤
            document.getElementById('fixedScheduleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createFixedSchedule();
            });
        }

        // æ›´æ–°ç•¶å‰æ—¥æœŸé¡¯ç¤º
        function updateCurrentDate() {
            const options = { year: 'numeric', month: 'long' };
            document.getElementById('currentDate').textContent = currentDate.toLocaleDateString('zh-TW', options);
        }

        // å°èˆªè¡Œäº‹æ›†
        function navigateCalendar(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateCurrentDate();
            renderCalendar();
        }

        // åˆ‡æ›è¦–åœ–ï¼ˆåƒ…ä¿ç•™æœˆè¦–åœ–ï¼‰
        function changeView(view) {
            // åƒ…æ”¯æ´æœˆè¦–åœ–
            currentView = 'month';
            updateCurrentDate();
            renderCalendar();
        }

        // æ¸²æŸ“è¡Œäº‹æ›†
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            grid.className = 'calendar-grid month-view';
            renderMonthView(grid);
        }

        // æ¸²æŸ“æœˆè¦–åœ–
        function renderMonthView(grid) {
            // æ·»åŠ æ˜ŸæœŸæ¨™é¡Œ
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // ç²å–æœˆä»½çš„ç¬¬ä¸€å¤©å’Œæœ€å¾Œä¸€å¤©
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            // æ¸²æŸ“42å€‹æ ¼å­ï¼ˆ6é€±ï¼‰
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';
                cell.dataset.date = cellDate.toISOString().split('T')[0];
                
                if (cellDate.getMonth() !== currentDate.getMonth()) {
                    cell.classList.add('other-month');
                }
                
                if (isToday(cellDate)) {
                    cell.classList.add('today');
                }

                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = cellDate.getDate();
                cell.appendChild(dayNumber);

                // æ·»åŠ æ’ç­
                const dayShifts = getShiftsForDate(cellDate).filter(passesFilter);
                dayShifts.forEach(shift => {
                    const shiftElement = createShiftElement(shift);
                    cell.appendChild(shiftElement);
                });

                // æ·»åŠ æ‹–æ”¾åŠŸèƒ½
                setupCellDropZone(cell);
                
                grid.appendChild(cell);
            }
        }



        // å‰µå»ºæ’ç­å…ƒç´ 
        function createShiftElement(shift) {
            const staffMember = staff.find(s => s.id === shift.staffId);
            const element = document.createElement('div');
            
            let shiftClasses = `shift-item ${staffMember.role}`;
            if (shift.type === 'emergency') shiftClasses += ' emergency';
            if (shift.status === 'overtime') shiftClasses += ' overtime';
            
            element.className = shiftClasses;
            element.draggable = true;
            element.dataset.shiftId = shift.id;
            
            const duration = calculateShiftDuration(shift.startTime, shift.endTime);
            const statusIcon = shift.status === 'confirmed' ? 'âœ“' : shift.status === 'pending' ? 'â³' : 'âŒ';
            
            element.innerHTML = `
                <div class="shift-header">
                    <div class="shift-name">${staffMember.name}</div>
                    <div class="shift-actions">
                        <button class="shift-action-btn" onclick="event.stopPropagation(); editShift(${shift.id})" title="ç·¨è¼¯">âœï¸</button>
                        <button class="shift-action-btn" onclick="event.stopPropagation(); event.preventDefault(); deleteShift(${shift.id})" title="åˆªé™¤">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="shift-details">
                    ${shift.startTime}-${shift.endTime} (${duration}h)<br>
                    ${statusIcon} ${shift.notes || 'ä¸€èˆ¬æ’ç­'}<br>
                    <small>${staffMember.department} - ${staffMember.level}</small>
                </div>
            `;

            // æ‹–æ‹½äº‹ä»¶
            element.addEventListener('dragstart', function(e) {
                draggedShift = shift;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            });

            element.addEventListener('dragend', function() {
                this.classList.remove('dragging');
                draggedShift = null;
            });

            // é»æ“Šäº‹ä»¶ï¼ˆé˜²æ­¢æ‹–æ‹½æ™‚è§¸ç™¼ï¼‰
            element.addEventListener('click', function(e) {
                if (!e.target.classList.contains('shift-action-btn')) {
                    showShiftDetails(shift);
                }
            });

            return element;
        }

        // è¨ˆç®—æ’ç­æ™‚æ•¸
        function calculateShiftDuration(startTime, endTime) {
            const start = new Date(`2000-01-01T${startTime}:00`);
            let end = new Date(`2000-01-01T${endTime}:00`);
            
            // è™•ç†è·¨æ—¥æƒ…æ³
            if (end < start) {
                end.setDate(end.getDate() + 1);
            }
            
            return Math.round((end - start) / (1000 * 60 * 60) * 10) / 10;
        }

        // è¨­å®šæ ¼å­æ‹–æ”¾å€åŸŸ
        function setupCellDropZone(cell) {
            cell.addEventListener('dragover', function(e) {
                e.preventDefault();
                
                // æª¢æŸ¥æ˜¯å¦æ˜¯äººå“¡æ‹–æ‹½æˆ–æ’ç­æ‹–æ‹½
                const staffId = e.dataTransfer.getData('text/plain');
                if (staffId) {
                    e.dataTransfer.dropEffect = 'copy';
                } else if (draggedShift) {
                    e.dataTransfer.dropEffect = 'move';
                }
                
                this.classList.add('drop-zone');
            });

            cell.addEventListener('dragleave', function(e) {
                // åªæœ‰ç•¶æ»‘é¼ çœŸæ­£é›¢é–‹æ ¼å­æ™‚æ‰ç§»é™¤æ¨£å¼
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('drop-zone');
                }
            });

            cell.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drop-zone');
                
                const staffId = e.dataTransfer.getData('text/plain');
                
                if (staffId) {
                    // äººå“¡æ‹–æ‹½ - å¿«é€Ÿæ–°å¢æ’ç­
                    const staffMember = staff.find(s => s.id == staffId);
                    if (staffMember) {
                        quickAddShiftFromDrag(staffMember, this.dataset.date);
                    }
                } else if (draggedShift) {
                    // æ’ç­æ‹–æ‹½ - ç§»å‹•æ’ç­
                    const newDate = this.dataset.date;
                    
                    // æ›´æ–°æ’ç­æ—¥æœŸ
                    draggedShift.date = newDate;
                    
                    renderCalendar();
                    showNotification('æ’ç­å·²æˆåŠŸç§»å‹•ï¼');
                }
            });

            // é»æ“Šæ·»åŠ æ’ç­
            cell.addEventListener('click', function(e) {
                // é¿å…åœ¨æ‹–æ‹½æ“ä½œæ™‚è§¸ç™¼é»æ“Š
                if (!e.target.closest('.shift-item')) {
                    openShiftModal(this.dataset.date);
                }
            });
        }

        // å¿«é€Ÿæ–°å¢æ’ç­ï¼ˆå¾æ‹–æ‹½ï¼‰
        function quickAddShiftFromDrag(staffMember, date, hour) {
            // æœˆè¦–åœ– - é è¨­æ—©ç­
            const startTime = '08:00';
            const endTime = '16:00';
            const shiftType = 'morning';
            
            // æª¢æŸ¥æ˜¯å¦å·²æœ‰æ’ç­è¡çª
            const existingShift = shifts.find(s =>
                s.staffId === staffMember.id &&
                s.date === date &&
                s.startTime === startTime
            );
            
            if (existingShift) {
                showNotification(`${staffMember.name} åœ¨è©²æ™‚æ®µå·²æœ‰æ’ç­ï¼`);
                return;
            }
            
            // æ–°å¢æ’ç­
            const newShift = {
                id: Date.now(),
                staffId: staffMember.id,
                date: date,
                startTime: startTime,
                endTime: endTime,
                type: shiftType,
                status: 'confirmed',
                notes: 'æ‹–æ‹½å¿«é€Ÿæ–°å¢'
            };
            
            shifts.push(newShift);
            renderCalendar();
            renderStaffPanel(); // æ›´æ–°äººå“¡ç‹€æ…‹
            updateStats();
            
            const shiftTypeName = getShiftTypeName(shiftType);
            showNotification(`å·²ç‚º ${staffMember.name} æ–°å¢ ${shiftTypeName} (${startTime}-${endTime})ï¼`);
        }

        // è¼”åŠ©å‡½æ•¸
        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function getShiftsForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            return shifts.filter(shift => shift.date === dateStr);
        }

        // æ¸²æŸ“äººå“¡é¢æ¿
        function renderStaffPanel() {
            const grid = document.getElementById('staffGrid');
            grid.innerHTML = '';

            const filteredStaff = getFilteredStaff();

            filteredStaff.forEach(member => {
                const card = document.createElement('div');
                card.className = `staff-card ${member.role}`;
                card.draggable = true;
                card.dataset.staffId = member.id;
                

                
                card.innerHTML = `
                    <div class="staff-name">${member.name}</div>
                    <div class="drag-hint">ğŸ–±ï¸</div>
                `;

                // è¨­å®šæ‹–æ‹½äº‹ä»¶
                setupStaffDragEvents(card, member);
                
                grid.appendChild(card);
            });

            // æ›´æ–°äººå“¡é¸æ“‡ä¸‹æ‹‰é¸å–®
            updateStaffSelects();
        }

        // è¨­å®šäººå“¡æ‹–æ‹½äº‹ä»¶
        function setupStaffDragEvents(card, member) {
            let draggedStaffMember = null;

            card.addEventListener('dragstart', function(e) {
                draggedStaffMember = member;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'copy';
                e.dataTransfer.setData('text/plain', member.id);
                
                // é«˜äº®å¯æ”¾ç½®çš„å€åŸŸ
                document.querySelectorAll('.calendar-cell').forEach(cell => {
                    cell.classList.add('drop-target');
                });
            });

            card.addEventListener('dragend', function() {
                this.classList.remove('dragging');
                draggedStaffMember = null;
                
                // ç§»é™¤é«˜äº®
                document.querySelectorAll('.calendar-cell').forEach(cell => {
                    cell.classList.remove('drop-target');
                });
            });

            // å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›å…¶ä»–å‡½æ•¸ä½¿ç”¨
            card.draggedStaffMember = member;
        }

        // ç²å–ç¯©é¸å¾Œçš„äººå“¡
        function getFilteredStaff() {
            const filter = currentStaffFilter || 'all';
            
            switch (filter) {
                case 'doctor':
                    return staff.filter(s => s.role === 'doctor');
                case 'nurse':
                    return staff.filter(s => s.role === 'nurse');
                default:
                    return staff;
            }
        }

        // ç²å–ä»Šæ—¥äººå“¡æ’ç­
        function getTodayShiftsForStaff(staffId) {
            const today = new Date().toISOString().split('T')[0];
            return shifts.filter(shift => shift.staffId === staffId && shift.date === today);
        }

        // ç²å–äººå“¡ç‹€æ…‹
        function getStaffStatus(staffId, todayShifts) {
            if (todayShifts.length === 0) {
                return { class: '', icon: 'âœ…', text: 'å¯æ’ç­' };
            } else if (todayShifts.length === 1) {
                return { class: 'partial', icon: 'â°', text: 'å·²æ’ç­' };
            } else {
                return { class: 'busy', icon: 'ğŸ”´', text: 'æ»¿ç­' };
            }
        }

        // æ›´æ–°äººå“¡é¸æ“‡ä¸‹æ‹‰é¸å–®
        function updateStaffSelects() {
            const select = document.getElementById('staffSelect');
            select.innerHTML = '';
            staff.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = `${member.name} (${member.role === 'doctor' ? 'é†«å¸«' : 'è­·ç†å¸«'})`;
                select.appendChild(option);
            });

            // æ›´æ–°å›ºå®šæ’ç­äººå“¡é¸æ“‡ä¸‹æ‹‰é¸å–®
            const fixedSelect = document.getElementById('fixedStaffSelect');
            if (fixedSelect) {
                fixedSelect.innerHTML = '';
                staff.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${member.role === 'doctor' ? 'é†«å¸«' : 'è­·ç†å¸«'}) - ${member.department}`;
                    fixedSelect.appendChild(option);
                });
            }
        }

        // æ¨¡æ…‹æ¡†æ“ä½œ
        function openShiftModal(date = null, staffId = null) {
            const modal = document.getElementById('shiftModal');
            const form = document.getElementById('shiftForm');
            
            // é‡ç½®è¡¨å–®
            form.reset();
            
            // è¨­å®šé è¨­å€¼
            if (date) {
                document.getElementById('shiftDate').value = date;
            } else {
                document.getElementById('shiftDate').value = currentDate.toISOString().split('T')[0];
            }
            
            if (staffId) {
                document.getElementById('staffSelect').value = staffId;
            }
            
            // è¨­å®šé è¨­æ™‚é–“
            document.getElementById('startTime').value = '08:00';
            document.getElementById('endTime').value = '16:00';
            
            modal.classList.add('show');
        }

        function closeModal() {
            document.getElementById('shiftModal').classList.remove('show');
        }

        // æ–°å¢æ’ç­
        function addShift() {
            const form = document.getElementById('shiftForm');
            const modal = document.getElementById('shiftModal');
            const editId = modal.dataset.editId;
            
            // é©—è­‰å¿…å¡«æ¬„ä½
            const staffId = document.getElementById('staffSelect').value;
            const date = document.getElementById('shiftDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const type = document.getElementById('shiftType').value;
            
            if (!staffId || !date || !startTime || !endTime || !type) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
                return;
            }
            
            const shiftData = {
                staffId: parseInt(staffId),
                date: date,
                startTime: startTime,
                endTime: endTime,
                type: type,
                status: 'confirmed',
                notes: document.getElementById('shiftNotes') ? document.getElementById('shiftNotes').value : ''
            };
            
            if (editId) {
                // ç·¨è¼¯æ¨¡å¼
                const shiftIndex = shifts.findIndex(s => s.id == editId);
                if (shiftIndex !== -1) {
                    shifts[shiftIndex] = { ...shifts[shiftIndex], ...shiftData };
                    showNotification('æ’ç­æ›´æ–°æˆåŠŸï¼');
                }
                delete modal.dataset.editId;
                modal.querySelector('h3').textContent = 'æ–°å¢æ’ç­';
            } else {
                // æ–°å¢æ¨¡å¼
                const newShift = {
                    id: Date.now(),
                    ...shiftData
                };
                shifts.push(newShift);
                showNotification('æ’ç­æ–°å¢æˆåŠŸï¼');
            }
            
            // é‡ç½®è¡¨å–®ä¸¦é—œé–‰è¦–çª—
            form.reset();
            modal.classList.remove('show');
            
            // æ›´æ–°é¡¯ç¤º
            renderCalendar();
            updateStats();
        }

        // åŒæ­¥åˆ° Google Calendar
        function syncToGoogle() {
            // å‰µå»º Google Calendar äº‹ä»¶æ ¼å¼
            const events = shifts.map(shift => {
                const staff = staff.find(s => s.id === shift.staffId);
                const startDateTime = `${shift.date}T${shift.startTime}:00`;
                const endDateTime = `${shift.date}T${shift.endTime}:00`;
                
                return {
                    title: `${staff.name} - ${staff.role === 'doctor' ? 'é†«å¸«' : 'è­·ç†å¸«'}æ’ç­`,
                    start: startDateTime,
                    end: endDateTime,
                    description: `éƒ¨é–€: ${staff.department}\nç­åˆ¥: ${shift.type}`
                };
            });

            // ç”Ÿæˆ Google Calendar URL
            const baseUrl = 'https://calendar.google.com/calendar/render?action=TEMPLATE';
            const event = events[0]; // ç¤ºç¯„ç”¨ç¬¬ä¸€å€‹äº‹ä»¶
            if (event) {
                const params = new URLSearchParams({
                    text: event.title,
                    dates: `${event.start.replace(/[-:]/g, '')}/${event.end.replace(/[-:]/g, '')}`,
                    details: event.description
                });
                
                window.open(`${baseUrl}&${params.toString()}`, '_blank', 'noopener,noreferrer');
                showNotification('æ­£åœ¨é–‹å•Ÿ Google Calendar...');
            } else {
                showNotification('æ²’æœ‰æ’ç­è³‡æ–™å¯åŒæ­¥');
            }
        }

        // åŒ¯å‡º iCal
        function exportToICal() {
            let icalContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//é†«ç™‚æ’ç­ç³»çµ±//æ’ç­è¡Œäº‹æ›†//ZH',
                'CALSCALE:GREGORIAN'
            ];

            shifts.forEach(shift => {
                const staffMember = staff.find(s => s.id === shift.staffId);
                const startDateTime = `${shift.date.replace(/-/g, '')}T${shift.startTime.replace(':', '')}00`;
                const endDateTime = `${shift.date.replace(/-/g, '')}T${shift.endTime.replace(':', '')}00`;
                
                icalContent.push(
                    'BEGIN:VEVENT',
                    `UID:${shift.id}@medical-schedule.com`,
                    `DTSTART:${startDateTime}`,
                    `DTEND:${endDateTime}`,
                    `SUMMARY:${staffMember.name} - ${staffMember.role === 'doctor' ? 'é†«å¸«' : 'è­·ç†å¸«'}æ’ç­`,
                    `DESCRIPTION:éƒ¨é–€: ${staffMember.department}\\nç­åˆ¥: ${shift.type}`,
                    `LOCATION:é†«é™¢`,
                    'END:VEVENT'
                );
            });

            icalContent.push('END:VCALENDAR');

            // å‰µå»ºä¸‹è¼‰é€£çµ
            const blob = new Blob([icalContent.join('\r\n')], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'é†«ç™‚æ’ç­è¡Œäº‹æ›†.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification('iCal æª”æ¡ˆå·²ä¸‹è¼‰ï¼');
        }

        // æ–°å¢åŠŸèƒ½å‡½æ•¸
        
        // å›åˆ°ä»Šå¤©
        function goToToday() {
            currentDate = new Date();
            updateCurrentDate();
            renderCalendar();
            updateStats();
        }

        // æ‡‰ç”¨ç¯©é¸
        function applyFilters() {
            currentFilters.department = document.getElementById('departmentFilter').value;
            currentFilters.role = document.getElementById('roleFilter').value;
            currentFilters.shiftType = document.getElementById('shiftTypeFilter').value;
            currentFilters.staffSearch = document.getElementById('staffSearch').value.toLowerCase();
            
            renderCalendar();
            updateStats();
        }

        // æª¢æŸ¥æ’ç­æ˜¯å¦ç¬¦åˆç¯©é¸æ¢ä»¶
        function passesFilter(shift) {
            const staffMember = staff.find(s => s.id === shift.staffId);
            
            if (currentFilters.department && staffMember.department !== currentFilters.department) return false;
            if (currentFilters.role && staffMember.role !== currentFilters.role) return false;
            if (currentFilters.shiftType && shift.type !== currentFilters.shiftType) return false;
            if (currentFilters.staffSearch && !staffMember.name.toLowerCase().includes(currentFilters.staffSearch)) return false;
            
            return true;
        }

        // æ›´æ–°çµ±è¨ˆè³‡è¨Š
        function updateStats() {
            // çµ±è¨ˆåŠŸèƒ½å·²ç§»é™¤ï¼Œä¿ç•™å‡½æ•¸ä»¥é¿å…éŒ¯èª¤
        }



        // æª¢æŸ¥è¡çª
        function checkConflicts() {
            const conflicts = checkAllConflicts();
            
            if (conflicts.length === 0) {
                showNotification('æ²’æœ‰ç™¼ç¾æ’ç­è¡çªï¼');
                return;
            }

            let message = `ç™¼ç¾ ${conflicts.length} å€‹æ’ç­è¡çªï¼š\n\n`;
            conflicts.forEach((conflict, index) => {
                const staff1 = staff.find(s => s.id === conflict.shift1.staffId);
                const staff2 = staff.find(s => s.id === conflict.shift2.staffId);
                message += `${index + 1}. ${staff1.name} åœ¨ ${conflict.shift1.date} æœ‰é‡ç–Šæ’ç­\n`;
            });

            alert(message);
        }

        // æª¢æŸ¥æ‰€æœ‰è¡çª
        function checkAllConflicts() {
            const conflicts = [];
            
            for (let i = 0; i < shifts.length; i++) {
                for (let j = i + 1; j < shifts.length; j++) {
                    const shift1 = shifts[i];
                    const shift2 = shifts[j];
                    
                    if (shift1.staffId === shift2.staffId && shift1.date === shift2.date) {
                        const start1 = new Date(`2000-01-01T${shift1.startTime}:00`);
                        const end1 = new Date(`2000-01-01T${shift1.endTime}:00`);
                        const start2 = new Date(`2000-01-01T${shift2.startTime}:00`);
                        const end2 = new Date(`2000-01-01T${shift2.endTime}:00`);
                        
                        if (start1 < end2 && start2 < end1) {
                            conflicts.push({ shift1, shift2 });
                        }
                    }
                }
            }
            
            return conflicts;
        }

        // æ¸…ç©ºæ‰€æœ‰æ’ç­
        function clearAllShifts() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ’ç­å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                shifts = [];
                renderCalendar();
                updateStats();
                showNotification('æ‰€æœ‰æ’ç­å·²æ¸…ç©ºï¼');
            }
        }

        // ç·¨è¼¯æ’ç­
        function editShift(shiftId) {
            const shift = shifts.find(s => s.id === shiftId);
            if (!shift) return;

            // å¡«å…¥ç¾æœ‰è³‡æ–™åˆ°è¡¨å–®
            document.getElementById('staffSelect').value = shift.staffId;
            document.getElementById('shiftDate').value = shift.date;
            document.getElementById('startTime').value = shift.startTime;
            document.getElementById('endTime').value = shift.endTime;
            document.getElementById('shiftType').value = shift.type;

            // æ¨™è¨˜ç‚ºç·¨è¼¯æ¨¡å¼
            const modal = document.getElementById('shiftModal');
            modal.dataset.editId = shiftId;
            modal.querySelector('h3').textContent = 'ç·¨è¼¯æ’ç­';
            modal.classList.add('show');
        }

        // åˆªé™¤æ’ç­
        function deleteShift(shiftId) {
            // å¼·åˆ¶åœæ­¢äº‹ä»¶å‚³æ’­
            event.stopPropagation();
            event.preventDefault();
            
            // ç²å–æ’ç­è³‡è¨Šç”¨æ–¼ç¢ºèªå°è©±æ¡†
            const shift = shifts.find(s => s.id == shiftId);
            if (!shift) {
                showNotification('æ‰¾ä¸åˆ°è¦åˆªé™¤çš„æ’ç­ï¼');
                return;
            }
            
            const staffMember = staff.find(s => s.id === shift.staffId);
            const confirmMessage = `ç¢ºå®šè¦åˆªé™¤ä»¥ä¸‹æ’ç­å—ï¼Ÿ\n\n` +
                                 `äººå“¡ï¼š${staffMember.name}\n` +
                                 `æ—¥æœŸï¼š${shift.date}\n` +
                                 `æ™‚é–“ï¼š${shift.startTime} - ${shift.endTime}\n` +
                                 `å‚™è¨»ï¼š${shift.notes || 'ç„¡'}\n\n` +
                                 `æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`;
            
            if (confirm(confirmMessage)) {
                const shiftIndex = shifts.findIndex(s => s.id == shiftId);
                if (shiftIndex !== -1) {
                    shifts.splice(shiftIndex, 1);
                    renderCalendar();
                    updateStats();
                    showNotification('æ’ç­å·²åˆªé™¤ï¼');
                } else {
                    showNotification('åˆªé™¤å¤±æ•—ï¼šæ‰¾ä¸åˆ°æ’ç­è³‡æ–™ï¼');
                }
            }
        }

        // é¡¯ç¤ºæ’ç­è©³æƒ…
        function showShiftDetails(shift) {
            const staffMember = staff.find(s => s.id === shift.staffId);
            const duration = calculateShiftDuration(shift.startTime, shift.endTime);
            
            alert(`æ’ç­è©³æƒ…ï¼š
å§“åï¼š${staffMember.name}
è·ä½ï¼š${staffMember.level}
éƒ¨é–€ï¼š${staffMember.department}
æ—¥æœŸï¼š${shift.date}
æ™‚é–“ï¼š${shift.startTime} - ${shift.endTime} (${duration} å°æ™‚)
ç‹€æ…‹ï¼š${shift.status === 'confirmed' ? 'å·²ç¢ºèª' : shift.status === 'pending' ? 'å¾…ç¢ºèª' : 'å·²å–æ¶ˆ'}
å‚™è¨»ï¼š${shift.notes || 'ç„¡'}
è¯çµ¡é›»è©±ï¼š${staffMember.phone}
é›»å­éƒµä»¶ï¼š${staffMember.email}`);
        }

        // æ ¹æ“šIDé¡¯ç¤ºæ’ç­è©³æƒ…
        function showShiftDetailsById(shiftId) {
            const shift = shifts.find(s => s.id === shiftId);
            if (shift) {
                showShiftDetails(shift);
            }
        }

        // åˆ—å°æ’ç­è¡¨
        function printSchedule() {
            const printWindow = window.open('', '_blank', 'noopener,noreferrer');
            const printContent = generatePrintContent();
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>é†«ç™‚æ’ç­è¡¨</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .header { text-align: center; margin-bottom: 20px; }
                        .shift-doctor { background-color: #e8f5e8; }
                        .shift-nurse { background-color: #fff3e0; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    ${printContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // ç”Ÿæˆåˆ—å°å…§å®¹
        function generatePrintContent() {
            const currentMonth = currentDate.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long' });
            let content = `
                <div class="header">
                    <h1>é†«ç™‚æ’ç­è¡¨</h1>
                    <h2>${currentMonth}</h2>
                    <p>åˆ—å°æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>å§“å</th>
                            <th>è·ä½</th>
                            <th>éƒ¨é–€</th>
                            <th>ç­åˆ¥</th>
                            <th>æ™‚é–“</th>
                            <th>ç‹€æ…‹</th>
                            <th>å‚™è¨»</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const sortedShifts = shifts
                .filter(passesFilter)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            sortedShifts.forEach(shift => {
                const staffMember = staff.find(s => s.id === shift.staffId);
                const statusText = shift.status === 'confirmed' ? 'å·²ç¢ºèª' : shift.status === 'pending' ? 'å¾…ç¢ºèª' : 'å·²å–æ¶ˆ';
                const rowClass = staffMember.role === 'doctor' ? 'shift-doctor' : 'shift-nurse';
                
                content += `
                    <tr class="${rowClass}">
                        <td>${shift.date}</td>
                        <td>${staffMember.name}</td>
                        <td>${staffMember.level}</td>
                        <td>${staffMember.department}</td>
                        <td>${getShiftTypeName(shift.type)}</td>
                        <td>${shift.startTime} - ${shift.endTime}</td>
                        <td>${statusText}</td>
                        <td>${shift.notes || ''}</td>
                    </tr>
                `;
            });

            content += `
                    </tbody>
                </table>
            `;

            return content;
        }

        // ç²å–ç­åˆ¥åç¨±
        function getShiftTypeName(type) {
            const types = {
                'morning': 'æ—©ç­',
                'afternoon': 'ä¸­ç­',
                'night': 'å¤œç­',
                'emergency': 'æ€¥è¨º',
                'custom': 'è‡ªè¨‚'
            };
            return types[type] || type;
        }



        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // å›ºå®šæ’ç­åŠŸèƒ½
        
        // é–‹å•Ÿå›ºå®šæ’ç­æ¨¡æ…‹æ¡†
        function openFixedScheduleModal() {
            const modal = document.getElementById('fixedScheduleModal');
            const form = document.getElementById('fixedScheduleForm');
            
            // é‡ç½®è¡¨å–®
            form.reset();
            
            // è¨­å®šé è¨­å€¼
            document.getElementById('fixedShiftType').value = 'morning';
            document.getElementById('fixedStartTime').value = '08:00';
            document.getElementById('fixedEndTime').value = '16:00';
            document.getElementById('scheduleRange').value = 'current-month';
            document.getElementById('fixedScheduleNotes').value = 'å›ºå®šä¸Šç­æ’ç¨‹';
            
            // é è¨­é¸æ“‡é€±ä¸€åˆ°é€±äº”
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`day${i}`).checked = true;
            }
            document.getElementById('day0').checked = false;
            document.getElementById('day6').checked = false;
            
            // éš±è—è‡ªè¨‚æ™‚é–“å’Œæ—¥æœŸç¯„åœ
            document.getElementById('customTimeGroup').style.display = 'none';
            document.getElementById('customRangeGroup').style.display = 'none';
            
            modal.classList.add('show');
        }

        // é—œé–‰å›ºå®šæ’ç­æ¨¡æ…‹æ¡†
        function closeFixedScheduleModal() {
            document.getElementById('fixedScheduleModal').classList.remove('show');
        }

        // å»ºç«‹å›ºå®šæ’ç­
        function createFixedSchedule() {
            const staffId = parseInt(document.getElementById('fixedStaffSelect').value);
            const shiftType = document.getElementById('fixedShiftType').value;
            const scheduleRange = document.getElementById('scheduleRange').value;
            const notes = document.getElementById('fixedScheduleNotes').value;
            const replaceExisting = document.getElementById('replaceExisting').checked;
            
            // ç²å–é¸æ“‡çš„å·¥ä½œæ—¥
            const selectedDays = [];
            for (let i = 0; i < 7; i++) {
                if (document.getElementById(`day${i}`).checked) {
                    selectedDays.push(i);
                }
            }
            
            if (selectedDays.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å·¥ä½œæ—¥ï¼');
                return;
            }
            
            // ç²å–æ™‚é–“
            let startTime, endTime;
            if (shiftType === 'custom') {
                startTime = document.getElementById('fixedStartTime').value;
                endTime = document.getElementById('fixedEndTime').value;
                if (!startTime || !endTime) {
                    alert('è«‹è¨­å®šè‡ªè¨‚æ™‚é–“ï¼');
                    return;
                }
            } else {
                const timeMap = {
                    'morning': { start: '08:00', end: '16:00' },
                    'afternoon': { start: '16:00', end: '24:00' },
                    'night': { start: '00:00', end: '08:00' }
                };
                startTime = timeMap[shiftType].start;
                endTime = timeMap[shiftType].end;
            }
            
            // ç²å–æ—¥æœŸç¯„åœ
            let startDate, endDate;
            const today = new Date();
            
            switch (scheduleRange) {
                case 'current-month':
                    startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                    endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                    break;
                case 'next-month':
                    startDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                    endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0);
                    break;
                case 'current-and-next':
                    startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                    endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0);
                    break;
                case 'custom-range':
                    const startDateStr = document.getElementById('rangeStartDate').value;
                    const endDateStr = document.getElementById('rangeEndDate').value;
                    if (!startDateStr || !endDateStr) {
                        alert('è«‹è¨­å®šè‡ªè¨‚æ—¥æœŸç¯„åœï¼');
                        return;
                    }
                    startDate = new Date(startDateStr);
                    endDate = new Date(endDateStr);
                    break;
            }
            
            // ç”Ÿæˆæ’ç­
            const newShifts = [];
            let shiftIdCounter = Date.now();
            let addedCount = 0;
            let replacedCount = 0;
            
            for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
                const dayOfWeek = date.getDay();
                
                if (selectedDays.includes(dayOfWeek)) {
                    const dateStr = date.toISOString().split('T')[0];
                    
                    // æª¢æŸ¥æ˜¯å¦å·²æœ‰æ’ç­
                    const existingShiftIndex = shifts.findIndex(s =>
                        s.staffId === staffId && s.date === dateStr
                    );
                    
                    if (existingShiftIndex !== -1) {
                        if (replaceExisting) {
                            // æ›¿æ›ç¾æœ‰æ’ç­
                            shifts[existingShiftIndex] = {
                                ...shifts[existingShiftIndex],
                                startTime: startTime,
                                endTime: endTime,
                                type: shiftType,
                                notes: notes
                            };
                            replacedCount++;
                        }
                        // å¦‚æœä¸æ›¿æ›ï¼Œè·³éé€™ä¸€å¤©
                    } else {
                        // æ–°å¢æ’ç­
                        const newShift = {
                            id: shiftIdCounter++,
                            staffId: staffId,
                            date: dateStr,
                            startTime: startTime,
                            endTime: endTime,
                            type: shiftType,
                            status: 'confirmed',
                            notes: notes
                        };
                        shifts.push(newShift);
                        addedCount++;
                    }
                }
            }
            
            // æ›´æ–°é¡¯ç¤º
            renderCalendar();
            updateStats();
            closeFixedScheduleModal();
            
            // é¡¯ç¤ºçµæœ
            const staffMember = staff.find(s => s.id === staffId);
            let message = `å›ºå®šæ’ç­å»ºç«‹å®Œæˆï¼\n\n`;
            message += `äººå“¡ï¼š${staffMember.name}\n`;
            message += `æ–°å¢æ’ç­ï¼š${addedCount} å¤©\n`;
            if (replacedCount > 0) {
                message += `æ›¿æ›æ’ç­ï¼š${replacedCount} å¤©\n`;
            }
            message += `æ™‚é–“ï¼š${startTime} - ${endTime}\n`;
            message += `å·¥ä½œæ—¥ï¼š${selectedDays.map(d => ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d]).join('ã€')}`;
            
            showNotification(`å·²ç‚º ${staffMember.name} å»ºç«‹å›ºå®šæ’ç­ï¼æ–°å¢ ${addedCount} å¤©${replacedCount > 0 ? `ï¼Œæ›¿æ› ${replacedCount} å¤©` : ''}ã€‚`);
        }

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        document.getElementById('shiftModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // é»æ“Šå›ºå®šæ’ç­æ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        document.getElementById('fixedScheduleModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFixedScheduleModal();
            }
        });

        // äººå“¡ç¯©é¸åŠŸèƒ½
        function filterStaff(filter) {
            currentStaffFilter = filter;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.staff-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é‡æ–°æ¸²æŸ“äººå“¡é¢æ¿
            renderStaffPanel();
        }

        // æŸ¥çœ‹äººå“¡æ’ç­
        function viewStaffSchedule(staffId) {
            const staffMember = staff.find(s => s.id === staffId);
            const staffShifts = shifts.filter(s => s.staffId === staffId)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            if (staffShifts.length === 0) {
                alert(`${staffMember.name} ç›®å‰æ²’æœ‰æ’ç­è¨˜éŒ„ã€‚`);
                return;
            }
            
            let scheduleText = `${staffMember.name} çš„æ’ç­è¨˜éŒ„ï¼š\n\n`;
            staffShifts.forEach(shift => {
                const date = new Date(shift.date).toLocaleDateString('zh-TW');
                const duration = calculateShiftDuration(shift.startTime, shift.endTime);
                scheduleText += `ğŸ“… ${date} ${shift.startTime}-${shift.endTime} (${duration}h) - ${getShiftTypeName(shift.type)}\n`;
                if (shift.notes) scheduleText += `   å‚™è¨»: ${shift.notes}\n`;
            });
            
            alert(scheduleText);
        }

        // è¯çµ¡äººå“¡
        function contactStaff(staffId) {
            const staffMember = staff.find(s => s.id === staffId);
            const contactInfo = `è¯çµ¡ ${staffMember.name}ï¼š\n\n` +
                              `ğŸ“ é›»è©±: ${staffMember.phone}\n` +
                              `ğŸ“§ ä¿¡ç®±: ${staffMember.email}\n` +
                              `ğŸ¥ éƒ¨é–€: ${staffMember.department}\n` +
                              `ğŸ‘” è·ä½: ${staffMember.level}`;
            
            if (confirm(contactInfo + '\n\nè¦æ’¥æ‰“é›»è©±å—ï¼Ÿ')) {
                // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œé€™è£¡å¯ä»¥æ•´åˆé›»è©±ç³»çµ±
                window.open(`tel:${staffMember.phone}`, '_blank', 'noopener,noreferrer');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9852105045b84a33',t:'MTc1ODg4MjM5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
