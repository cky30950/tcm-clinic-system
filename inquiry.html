<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中醫預診系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Firebase 初始化腳本，供問診結果上傳使用 -->
    <script type="module" src="firebase_init.js"></script>
    <style>
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .form-container {
                padding: 1.5rem;
                margin: 0 0.5rem;
            }
            
            .grid-mobile {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .color-grid-mobile {
                grid-template-columns: repeat(4, 1fr);
                gap: 0.75rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .nav-buttons button {
                width: 100%;
                padding: 1rem;
                font-size: 1.1rem;
            }
            
            .section-title {
                font-size: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .input-field {
                padding: 1rem;
                font-size: 1rem;
            }
            
            .checkbox-item, .radio-item {
                padding: 1rem;
                margin-bottom: 0.5rem;
                border-radius: 0.75rem;
                border: 2px solid #e5e7eb;
                transition: all 0.3s ease;
            }
            
            .checkbox-item:hover, .radio-item:hover {
                border-color: #3b82f6;
                background-color: #eff6ff;
            }
            
            .checkbox-item.checked, .radio-item.checked {
                border-color: #3b82f6;
                background-color: #dbeafe;
            }
        }

        .color-option {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: #374151;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .color-option.selected {
            border-color: #1f2937;
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
        
        .color-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #1f2937;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .section-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            transition: width 0.5s ease;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
        }
        
        .form-section {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .input-enhanced {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .input-enhanced:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .floating-label {
            position: relative;
        }
        
        .floating-label input:focus + label,
        .floating-label input:not(:placeholder-shown) + label {
            transform: translateY(-1.5rem) scale(0.8);
            color: #3b82f6;
        }
        
        .floating-label label {
            position: absolute;
            left: 1rem;
            top: 1rem;
            transition: all 0.3s ease;
            pointer-events: none;
            color: #6b7280;
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
            background: rgba(0, 0, 0, 0.6);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">中醫預診系統</h1>
            <p class="text-gray-600 text-sm sm:text-base px-4">請詳細填寫以下問診資料，幫助醫師更好地了解您的狀況</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container mb-6 sm:mb-8">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-600">問診進度</span>
                <span class="text-sm font-bold text-blue-600" id="progressText">1/12</span>
            </div>
            <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="progress-bar h-4 rounded-full" style="width: 8%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-500 mt-2">
                <span>開始</span>
                <span>完成</span>
            </div>
        </div>


        <!-- Form Container -->
        <div class="section-card bg-white rounded-2xl shadow-xl p-4 sm:p-8 form-container">
            <form id="diagnosisForm">
                
                <!-- Section 1: Basic Info -->
                <div class="section slide-in" id="section1">
                    <!-- 預診須知 -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 mb-8">
                        <h3 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            預診須知
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-6 text-sm">
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border border-blue-100">
                                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        填寫目的
                                    </h4>
                                    <ul class="text-gray-600 space-y-1">
                                        <li>• 協助中醫師了解您的身體狀況</li>
                                        <li>• 提供完整的症狀描述</li>
                                        <li>• 節省看診時間，提高診療效率</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-white rounded-lg p-4 border border-blue-100">
                                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                        <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                                        填寫說明
                                    </h4>
                                    <ul class="text-gray-600 space-y-1">
                                        <li>• <span class="text-red-500 font-medium">紅色*</span> 為必填項目</li>
                                        <li>• <span class="text-green-500 font-medium">綠色○</span> 為選填項目</li>
                                        <li>• 請根據近期狀況如實填寫</li>
                                        <li>• 不確定的項目可以跳過</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border border-blue-100">
                                    <h4 class="font-semibold text-gray-800 mb-2 flex items-center">
                                        <span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>
                                        注意事項
                                    </h4>
                                    <ul class="text-gray-600 space-y-1">
                                        <li>• 請在安靜環境下仔細填寫</li>
                                        <li>• 如有不適症狀請詳細描述</li>
                                        <li>• 過敏史和用藥史請務必告知</li>
                                        <li>• 填寫時間約需 10-15 分鐘</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-white rounded-lg p-4 border border-yellow-100 bg-yellow-50">
                                    <h4 class="font-semibold text-yellow-800 mb-2 flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                        重要提醒
                                    </h4>
                                    <ul class="text-yellow-700 space-y-1">
                                        <li>• 此問診不能替代醫師診斷</li>
                                        <li>• 緊急症狀請立即就醫</li>
                                        <li>• 資料僅供醫療參考使用</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-white rounded-lg border border-blue-100">
                            <p class="text-center text-gray-600 text-sm">
                                <span class="font-medium text-blue-600">溫馨提示：</span>
                                請放心填寫，您的個人資料將受到嚴格保護，僅用於醫療診斷參考
                            </p>
                        </div>
                    </div>


        
        <!-- Form Container -->
        <div class="section-card bg-white rounded-2xl shadow-xl p-4 sm:p-8 form-container">
            <form id="diagnosisForm">
                
                <!-- Section 1: Basic Info -->
                <div class="section slide-in" id="section1">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-blue-100 text-blue-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">1</span>
                            基本資料
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 grid-mobile mb-8">
                            <div class="space-y-4">
                                <div class="space-y-3">
                                    <label class="block text-lg font-medium text-gray-700 mb-3">
                                        姓名
                                    </label>
                                    <input type="text" name="patientName" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg input-field" placeholder="請輸入您的姓名">
                                </div>
                                
                                <label class="block text-lg font-medium text-gray-700 mb-3 mt-6">
                                    性別
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="radio-item flex items-center justify-center cursor-pointer bg-gray-50 hover:bg-blue-50 border-2 border-gray-200 rounded-xl p-4 transition-all">
                                        <input type="radio" name="gender" value="男" class="sr-only">
                                        <div class="flex items-center">
                                            <span class="text-lg font-medium">男</span>
                                        </div>
                                    </label>
                                    <label class="radio-item flex items-center justify-center cursor-pointer bg-gray-50 hover:bg-blue-50 border-2 border-gray-200 rounded-xl p-4 transition-all">
                                        <input type="radio" name="gender" value="女" class="sr-only">
                                        <div class="flex items-center">
                                            <span class="text-lg font-medium">女</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        
                            <div class="space-y-6">
                                <label class="block text-lg font-medium text-gray-700 mb-3">
                                    主要有什麼不舒服？
                                </label>
                                
                                <!-- Body Part Selection -->
                                <div class="space-y-3">
                                    <label class="block text-sm font-medium text-gray-600 mb-2">
                                        先選擇身體部位
                                    </label>
                                    <select id="bodyPart" name="bodyPart" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg input-field">
                                        <option value="">請選擇身體部位</option>
                                        <option value="head">頭部</option>
                                        <option value="neck">頸部</option>
                                        <option value="chest">胸部</option>
                                        <option value="abdomen">腹部</option>
                                        <option value="back">背部</option>
                                        <option value="arms">手臂</option>
                                        <option value="legs">腿部</option>
                                        <option value="joints">關節</option>
                                        <option value="skin">皮膚</option>
                                        <option value="internal">內科症狀</option>
                                        <option value="gynecology">婦科</option>
                                        <option value="andrology">男科</option>
                                        <option value="other">其他</option>
                                    </select>
                                </div>

                                <!-- Detailed Location Selection -->
                                <div class="space-y-3">
                                    <label class="block text-sm font-medium text-gray-600 mb-2">
                                        再選擇詳細位置
                                    </label>
                                    <select id="detailedLocation" name="detailedLocation" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg input-field" disabled>
                                        <option value="">請先選擇身體部位</option>
                                    </select>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

                <!-- Section 2: Additional Symptoms -->
                <div class="section hidden slide-in" id="section2">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-green-100 text-green-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">2</span>
                            症狀補充
                            <span class="text-green-600 text-lg ml-2">（選填）</span>
                        </h2>
                        <div id="symptomDescription" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <p class="text-blue-800 font-medium">根據您選擇的部位，請勾選相關症狀</p>
                        </div>
                        
                        <div id="symptomOptions" class="grid grid-cols-1 sm:grid-cols-2 gap-3 grid-mobile mb-6">
                            <!-- 症狀選項將根據選擇的身體部位動態生成 -->
                        </div>
                        
                        <div class="space-y-3 mt-6 pt-6 border-t border-gray-200">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述症狀
                            </label>
                            <textarea name="additionalSymptoms" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：疼痛、腫脹、發熱、麻木等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Sweating -->
                <div class="section hidden slide-in" id="section3">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-orange-100 text-orange-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">3</span>
                            汗出情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-8">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sweating" value="正常出汗" class="mr-3 w-5 h-5 text-blue-600">
                                <span>正常出汗</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sweating" value="容易出汗" class="mr-3 w-5 h-5 text-blue-600">
                                <span>容易出汗</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sweating" value="不易出汗" class="mr-3 w-5 h-5 text-blue-600">
                                <span>不易出汗</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sweating" value="盜汗" class="mr-3 w-5 h-5 text-blue-600">
                                <span>盜汗（睡覺時出汗）</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sweating" value="自汗" class="mr-3 w-5 h-5 text-blue-600">
                                <span>自汗（白天易出汗）</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sweating" value="手腳出汗" class="mr-3 w-5 h-5 text-blue-600">
                                <span>手腳出汗</span>
                            </label>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述出汗情況
                            </label>
                            <textarea name="sweatDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：出汗時間、出汗部位、出汗量多少、汗液顏色等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Temperature -->
                <div class="section hidden slide-in" id="section4">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-purple-100 text-purple-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">4</span>
                            寒熱情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-8">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="temperature" value="怕冷" class="mr-3 w-5 h-5 text-blue-600">
                                <span>怕冷</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="temperature" value="怕熱" class="mr-3 w-5 h-5 text-blue-600">
                                <span>怕熱</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="temperature" value="不怕冷不怕熱" class="mr-3 w-5 h-5 text-blue-600">
                                <span>不怕冷不怕熱</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="temperature" value="忽冷忽熱" class="mr-3 w-5 h-5 text-blue-600">
                                <span>忽冷忽熱</span>
                            </label>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="coldHands" value="手腳冰冷" class="mr-3 w-5 h-5 text-blue-600">
                                <span>手腳冰冷</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="coldHands" value="手心發熱" class="mr-3 w-5 h-5 text-blue-600">
                                <span>手心發熱</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述寒熱情況
                            </label>
                            <textarea name="temperatureDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：什麼時候特別怕冷或怕熱、身體哪個部位特別敏感等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 5: Appetite -->
                <div class="section hidden slide-in" id="section5">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">5</span>
                            胃口情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-8">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="appetite" value="食慾正常" class="mr-3 w-5 h-5 text-blue-600">
                                <span>食慾正常</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="appetite" value="食慾不振" class="mr-3 w-5 h-5 text-blue-600">
                                <span>食慾不振</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="appetite" value="食慾亢進" class="mr-3 w-5 h-5 text-blue-600">
                                <span>食慾亢進</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="appetite" value="時好時壞" class="mr-3 w-5 h-5 text-blue-600">
                                <span>時好時壞</span>
                            </label>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="appetiteSymptoms" value="容易餓" class="mr-3 w-5 h-5 text-blue-600">
                                <span>容易餓</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="appetiteSymptoms" value="吃一點就飽" class="mr-3 w-5 h-5 text-blue-600">
                                <span>吃一點就飽</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="appetiteSymptoms" value="飯後腹脹" class="mr-3 w-5 h-5 text-blue-600">
                                <span>飯後腹脹</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="appetiteSymptoms" value="噁心想吐" class="mr-3 w-5 h-5 text-blue-600">
                                <span>噁心想吐</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述胃口情況
                            </label>
                            <textarea name="appetiteDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：什麼時候食慾特別好或差、喜歡什麼口味、不喜歡什麼食物等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 6: Drinking -->
                <div class="section hidden slide-in" id="section6">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-cyan-100 text-cyan-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">6</span>
                            飲水情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-8">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="drinkingPreference" value="喜溫熱" class="mr-3 w-5 h-5 text-blue-600">
                                <span>喜溫熱</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="drinkingPreference" value="喜冷涼" class="mr-3 w-5 h-5 text-blue-600">
                                <span>喜冷涼</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="drinkingPreference" value="均可" class="mr-3 w-5 h-5 text-blue-600">
                                <span>均可</span>
                            </label>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="drinkingHabits" value="渴飲" class="mr-3 w-5 h-5 text-blue-600">
                                <span>渴飲</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="drinkingHabits" value="不渴飲" class="mr-3 w-5 h-5 text-blue-600">
                                <span>不渴飲</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="drinkingHabits" value="時常會忘記喝水" class="mr-3 w-5 h-5 text-blue-600">
                                <span>時常會忘記喝水</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="drinkingHabits" value="怎麼喝也不能止渴" class="mr-3 w-5 h-5 text-blue-600">
                                <span>怎麼喝也不能止渴</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述飲水情況
                            </label>
                            <textarea name="drinkingDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：每天大概喝多少水、什麼時候特別想喝水、喜歡什麼飲品等..."></textarea>
                        </div>
                    </div>
                </div>



                <!-- Section 7: Urination -->
                <div class="section hidden slide-in" id="section7">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-yellow-100 text-yellow-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">7</span>
                            小便情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="space-y-6 mb-8">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-3">夜尿多少次</label>
                                    <input type="number" name="nightUrination" min="0" max="10" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="次數">
                                </div>
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-3">平均一天幾次</label>
                                    <input type="number" name="dailyUrination" min="1" max="20" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="次數">
                                </div>
                            </div>

                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">小便顏色</label>
                                <div class="flex flex-wrap gap-3 p-4 bg-gray-50 rounded-lg">
                                    <div class="color-option" style="background-color: #fef3c7" data-color="淡黃色" title="淡黃色"></div>
                                    <div class="color-option" style="background-color: #fbbf24" data-color="黃色" title="黃色"></div>
                                    <div class="color-option" style="background-color: #d97706" data-color="深黃色" title="深黃色"></div>
                                    <div class="color-option" style="background-color: #dc2626" data-color="紅色" title="紅色"></div>
                                    <div class="color-option" style="background-color: #7c2d12" data-color="棕色" title="棕色"></div>
                                    <div class="color-option" style="background-color: #f3f4f6" data-color="無色" title="無色"></div>
                                    <div class="color-option" style="background-color: #6b7280" data-color="混濁" title="混濁"></div>
                                </div>
                                <input type="hidden" name="urineColor" id="urineColor">
                                <p class="text-sm text-gray-600 mt-2">已選擇: <span id="selectedUrineColor">未選擇</span></p>
                            </div>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="清長" class="mr-3 w-5 h-5 text-blue-600">
                                <span>清長</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="短赤" class="mr-3 w-5 h-5 text-blue-600">
                                <span>短赤</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="易急" class="mr-3 w-5 h-5 text-blue-600">
                                <span>易急</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="小便痛" class="mr-3 w-5 h-5 text-blue-600">
                                <span>小便痛</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="小便難去" class="mr-3 w-5 h-5 text-blue-600">
                                <span>小便難去</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="小便緩慢量少" class="mr-3 w-5 h-5 text-blue-600">
                                <span>小便緩慢量少</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="尿頻" class="mr-3 w-5 h-5 text-blue-600">
                                <span>尿頻</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="urination" value="沒有尿意" class="mr-3 w-5 h-5 text-blue-600">
                                <span>沒有尿意</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述小便情況
                            </label>
                            <textarea name="urinationDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：小便時的感覺、特殊氣味、泡沫情況等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 8: Bowel Movement -->
                <div class="section hidden slide-in" id="section8">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-amber-100 text-amber-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">8</span>
                            大便情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="space-y-6 mb-8">
                            <div class="grid md:grid-cols-2 gap-4">
                                <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                    <input type="radio" name="stoolForm" value="成形" class="mr-3 w-5 h-5 text-blue-600">
                                    <span>成形</span>
                                </label>
                                <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                    <input type="radio" name="stoolForm" value="不成形" class="mr-3 w-5 h-5 text-blue-600">
                                    <span>不成形</span>
                                </label>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-3">大便多少日一次</label>
                                    <input type="text" name="stoolFrequency" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg" placeholder="例如：每天1次、2天1次">
                                </div>
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-3">大便氣味</label>
                                    <select name="stoolOdor" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg">
                                        <option value="">請選擇</option>
                                        <option value="很臭">很臭</option>
                                        <option value="無味">無味</option>
                                        <option value="正常">正常</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">大便顏色</label>
                                <div class="flex flex-wrap gap-3 p-4 bg-gray-50 rounded-lg">
                                    <div class="color-option" style="background-color: #92400e" data-color="棕色" title="棕色"></div>
                                    <div class="color-option" style="background-color: #fbbf24" data-color="黃色" title="黃色"></div>
                                    <div class="color-option" style="background-color: #16a34a" data-color="綠色" title="綠色"></div>
                                    <div class="color-option" style="background-color: #dc2626" data-color="紅色" title="紅色"></div>
                                    <div class="color-option" style="background-color: #1f2937" data-color="黑色" title="黑色"></div>
                                    <div class="color-option" style="background-color: #f3f4f6" data-color="白色" title="白色"></div>
                                    <div class="color-option" style="background-color: #d97706" data-color="橙色" title="橙色"></div>
                                </div>
                                <input type="hidden" name="stoolColor" id="stoolColor">
                                <p class="text-sm text-gray-600 mt-2">已選擇: <span id="selectedStoolColor">未選擇</span></p>
                            </div>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="stoolSymptoms" value="乾燥結塊" class="mr-3 w-5 h-5 text-blue-600">
                                <span>乾燥結塊</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="stoolSymptoms" value="便秘" class="mr-3 w-5 h-5 text-blue-600">
                                <span>便秘</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="stoolSymptoms" value="容易腹瀉" class="mr-3 w-5 h-5 text-blue-600">
                                <span>容易腹瀉</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="stoolSymptoms" value="去完大便仍想去" class="mr-3 w-5 h-5 text-blue-600">
                                <span>去完大便仍想去</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述大便情況
                            </label>
                            <textarea name="stoolDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：排便時的感覺、是否用力、有無血絲、特殊情況等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 9: Sleep -->
                <div class="section hidden slide-in" id="section9">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-indigo-100 text-indigo-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">9</span>
                            睡眠情況
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-8">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sleepQuality" value="正常" class="mr-3 w-5 h-5 text-blue-600">
                                <span>正常</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="radio" name="sleepQuality" value="不好" class="mr-3 w-5 h-5 text-blue-600">
                                <span>不好</span>
                            </label>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="sleep" value="失眠" class="mr-3 w-5 h-5 text-blue-600">
                                <span>失眠</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="sleep" value="睡眠淺" class="mr-3 w-5 h-5 text-blue-600">
                                <span>睡眠淺</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="sleep" value="多夢" class="mr-3 w-5 h-5 text-blue-600">
                                <span>多夢</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="sleep" value="一覺到天亮" class="mr-3 w-5 h-5 text-blue-600">
                                <span>一覺到天亮</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="sleep" value="早醒" class="mr-3 w-5 h-5 text-blue-600">
                                <span>早醒</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="sleep" value="難入睡" class="mr-3 w-5 h-5 text-blue-600">
                                <span>難入睡</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述睡眠情況
                            </label>
                            <textarea name="sleepDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：幾點睡覺、睡多久、夢境內容、睡眠環境需求等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 10: Energy -->
                <div class="section hidden slide-in" id="section10">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-emerald-100 text-emerald-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">10</span>
                            體力精神
                        </h2>
                        
                        <!-- 必填項目 -->
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-red-500 mr-2">*</span>必填
                        </h3>
                        
                        <div class="space-y-4 mb-8">
                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">精神狀態</label>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="radio" name="energy" value="精神好" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>精神好</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="radio" name="energy" value="一直疲憊中" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>一直疲憊中</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center pt-6 border-t border-gray-200">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="morningEnergy" value="早上起床精神奕奕" class="mr-3 w-5 h-5 text-blue-600">
                                <span>早上起床精神奕奕</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="concentration" value="精神能夠集中" class="mr-3 w-5 h-5 text-blue-600">
                                <span>精神能夠集中</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="energySymptoms" value="容易疲勞" class="mr-3 w-5 h-5 text-blue-600">
                                <span>容易疲勞</span>
                            </label>
                            <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                <input type="checkbox" name="energySymptoms" value="下午特別累" class="mr-3 w-5 h-5 text-blue-600">
                                <span>下午特別累</span>
                            </label>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="block text-lg font-medium text-gray-700 mb-3">
                                補充描述體力精神情況
                            </label>
                            <textarea name="energyDescription" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：什麼時候精神最好、什麼情況下特別累、運動後的感覺等..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 11: Medical History -->
                <div class="section hidden slide-in" id="section11">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-red-100 text-red-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">11</span>
                            病史
                            <span class="text-green-600 text-lg ml-2">（選填）</span>
                        </h2>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="space-y-6">
                            <!-- Common Medical Conditions -->
                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">常見疾病</label>
                                <div class="grid md:grid-cols-2 gap-4 mb-6">
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="medicalHistory" value="高膽固醇" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>高膽固醇</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="medicalHistory" value="高血壓" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>高血壓</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="medicalHistory" value="慢性胃炎" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>慢性胃炎</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="medicalHistory" value="糖尿病" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>糖尿病</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="medicalHistory" value="心臟病" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>心臟病</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Detailed Medical History -->
                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">過去的健康狀況</label>
                                <p class="text-sm text-gray-600 mb-3">請詳細描述您曾經患過的疾病、手術、重大外傷等</p>
                                <textarea name="detailedMedicalHistory" rows="4" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="例如：
• 2020年膽囊切除手術
• 小時候曾患肺炎
• 車禍導致左腿骨折（已康復）
• 曾有心律不整問題
• 其他相關病史..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 12: Current Medications & Allergies -->
                <div class="section hidden slide-in" id="section12">
                    <div class="form-section">
                        <h2 class="section-title text-2xl sm:text-3xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="bg-teal-100 text-teal-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-3">12</span>
                            用藥及過敏史
                            <span class="text-green-600 text-lg ml-2">（選填）</span>
                        </h2>
                        
                        <!-- 選填項目 -->
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-green-500 mr-2">○</span>選填
                        </h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">正在服用的西藥</label>
                                <div class="grid md:grid-cols-2 gap-4 mb-6">
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="currentMeds" value="胃藥" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>胃藥</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="currentMeds" value="血壓藥" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>血壓藥</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="currentMeds" value="血糖藥" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>血糖藥</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="currentMeds" value="降膽固醇藥" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>降膽固醇藥</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="currentMeds" value="止痛藥" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>止痛藥</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="currentMeds" value="安眠藥" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>安眠藥</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">過敏史</label>
                                <div class="grid md:grid-cols-2 gap-4 mb-6">
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="allergies" value="中藥過敏" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>中藥過敏</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="allergies" value="G6PD" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>G6PD</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="allergies" value="食物過敏" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>食物過敏</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer p-3 rounded-lg hover:bg-blue-50">
                                        <input type="checkbox" name="allergies" value="藥物過敏" class="mr-3 w-5 h-5 text-blue-600">
                                        <span>藥物過敏</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-lg font-medium text-gray-700 mb-3">其他過敏或特殊情況</label>
                                <textarea name="otherAllergies" rows="3" class="input-enhanced w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg resize-none" placeholder="請詳細描述其他過敏情況或特殊狀況..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="nav-buttons flex justify-between mt-8 pt-6 border-t border-gray-200">
                    <button type="button" id="prevBtn" class="btn-secondary px-6 py-4 text-white rounded-xl font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center" disabled>
                        上一步
                    </button>
                    <button type="button" id="nextBtn" class="btn-primary px-6 py-4 text-white rounded-xl font-semibold text-lg flex items-center">
                        下一步
                    </button>
                    <button type="submit" id="submitBtn" class="btn-success px-6 py-4 text-white rounded-xl font-semibold text-lg hidden flex items-center">
                        提交問診
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Modal -->
        <div id="resultsModal" class="modal-backdrop fixed inset-0 hidden items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl p-6 sm:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl">✅</span>
                    </div>
                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">問診完成！</h2>
                    <p class="text-gray-600">您的問診資料已成功收集</p>
                </div>
                <div id="resultsContent" class="space-y-4"></div>
                <div class="flex justify-center mt-8">
                    <button onclick="closeResults()" class="btn-primary px-8 py-4 text-white rounded-xl font-semibold text-lg flex items-center">
                        完成
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSection = 1;
        const totalSections = 12;
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showSection(1);
            setupColorSelectors();
            setupBodyPartSelector();
            setupInteractiveElements();
        });

        function setupInteractiveElements() {
            // Setup radio buttons
            document.querySelectorAll('.radio-item').forEach(item => {
                item.addEventListener('click', function() {
                    const input = this.querySelector('input[type="radio"]');
                    const name = input.name;
                    
                    // Remove checked class from all items with same name
                    document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
                        radio.closest('.radio-item').classList.remove('checked');
                        radio.closest('.radio-item').style.borderColor = '#e5e7eb';
                        radio.closest('.radio-item').style.backgroundColor = '#f9fafb';
                    });
                    
                    // Add checked class to clicked item
                    this.classList.add('checked');
                    this.style.borderColor = '#3b82f6';
                    this.style.backgroundColor = '#dbeafe';
                    input.checked = true;
                });
            });

            // Setup checkbox buttons
            document.querySelectorAll('.checkbox-item').forEach(item => {
                item.addEventListener('click', function() {
                    const input = this.querySelector('input[type="checkbox"]');
                    const checkmark = this.querySelector('.ml-auto');
                    
                    input.checked = !input.checked;
                    
                    if (input.checked) {
                        this.classList.add('checked');
                        this.style.borderColor = '#3b82f6';
                        this.style.backgroundColor = '#dbeafe';
                        checkmark.style.opacity = '1';
                    } else {
                        this.classList.remove('checked');
                        this.style.borderColor = '#e5e7eb';
                        this.style.backgroundColor = '#f9fafb';
                        checkmark.style.opacity = '0';
                    }
                });
            });
        }

        function showSection(sectionNum) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show current section with animation
            const currentSection = document.getElementById(`section${sectionNum}`);
            currentSection.classList.remove('hidden');
            currentSection.classList.add('slide-in');
            
            // Update progress with animation
            const progress = (sectionNum / totalSections) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${sectionNum}/${totalSections}`;
            
            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = sectionNum === 1;
            
            if (sectionNum === totalSections) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'flex';
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.style.display = 'flex';
                submitBtn.style.display = 'none';
                submitBtn.classList.add('hidden');
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Re-setup interactive elements for new section
            setTimeout(() => {
                setupInteractiveElements();
            }, 100);
        }

        function setupColorSelectors() {
            // Urine color selector
            document.querySelectorAll('#section7 .color-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove previous selection
                    document.querySelectorAll('#section7 .color-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selection to clicked option
                    this.classList.add('selected');
                    const color = this.getAttribute('data-color');
                    document.getElementById('urineColor').value = color;
                    document.getElementById('selectedUrineColor').textContent = color;
                });
            });

            // Stool color selector
            document.querySelectorAll('#section8 .color-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove previous selection
                    document.querySelectorAll('#section8 .color-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selection to clicked option
                    this.classList.add('selected');
                    const color = this.getAttribute('data-color');
                    document.getElementById('stoolColor').value = color;
                    document.getElementById('selectedStoolColor').textContent = color;
                });
            });
        }

        function setupBodyPartSelector() {
            const bodyPartSelect = document.getElementById('bodyPart');
            const detailedLocationSelect = document.getElementById('detailedLocation');
            
            // Define symptoms for each body part
            const bodyPartSymptoms = {
                head: [
                    '頭痛', '頭暈', '頭脹', '偏頭痛', '頭重', '頭昏',
                    '眼乾', '眼痛', '視力模糊', '眼睛疲勞', '流淚',
                    '鼻塞', '流鼻水', '鼻乾', '嗅覺異常',
                    '耳鳴', '聽力下降', '耳痛', '耳脹',
                    '口乾', '口苦', '口臭', '牙痛', '牙齦腫痛'
                ],
                neck: [
                    '頸部僵硬', '頸痛', '落枕', '頸部活動受限',
                    '喉嚨痛', '喉嚨乾', '吞嚥困難', '聲音沙啞',
                    '頸部腫脹', '淋巴結腫大'
                ],
                chest: [
                    '胸痛', '胸悶', '胸脹', '心悸', '心慌',
                    '呼吸困難', '氣短', '咳嗽', '咳痰', '胸部壓迫感',
                    '乳房脹痛', '乳房硬塊', '肋間神經痛'
                ],
                abdomen: [
                    '腹痛', '腹脹', '腹瀉', '便秘', '噁心', '嘔吐',
                    '胃痛', '胃脹', '胃酸', '消化不良', '食慾不振',
                    '肝區疼痛', '右上腹痛', '左上腹痛', '下腹痛'
                ],
                back: [
                    '腰痛', '背痛', '脊椎痛', '肌肉僵硬', '活動受限',
                    '坐骨神經痛', '椎間盤突出症狀', '肩胛骨痛',
                    '上背痛', '中背痛', '下背痛'
                ],
                arms: [
                    '手臂痛', '肩膀痛', '手肘痛', '手腕痛',
                    '手指麻木', '手臂麻木', '手部無力', '握力減退',
                    '肩膀僵硬', '五十肩', '網球肘', '腕隧道症候群症狀'
                ],
                legs: [
                    '腿痛', '膝蓋痛', '腳踝痛', '足底痛',
                    '腿部麻木', '腿部無力', '腿部抽筋', '靜脈曲張',
                    '足跟痛', '腳趾痛', '行走困難', '腿部腫脹'
                ],
                joints: [
                    '關節痛', '關節僵硬', '關節腫脹', '活動受限',
                    '晨僵', '關節變形', '關節響聲', '關節無力',
                    '多發性關節痛', '遊走性關節痛'
                ],
                skin: [
                    '皮膚癢', '皮疹', '紅斑', '脫皮', '乾燥',
                    '濕疹', '蕁麻疹', '痤瘡', '色素沉著',
                    '皮膚敏感', '皮膚粗糙', '皮膚破損'
                ],
                internal: [
                    '發熱', '畏寒', '盜汗', '自汗', '乏力', '疲倦',
                    '失眠', '多夢', '健忘', '注意力不集中',
                    '情緒低落', '焦慮', '煩躁', '易怒',
                    '食慾不振', '體重下降', '體重增加'
                ],
                gynecology: [
                    '月經不調', '經痛', '經量過多', '經量過少',
                    '白帶異常', '外陰癢', '骨盆腔痛', '性交痛',
                    '乳房脹痛', '更年期症狀', '潮熱', '盜汗',
                    '情緒波動', '失眠', '陰道乾澀'
                ],
                andrology: [
                    '勃起困難', '早洩', '性慾減退', '射精困難',
                    '前列腺肥大症狀', '尿頻', '尿急', '夜尿',
                    '睪丸疼痛', '陰囊腫脹', '精液異常',
                    '性功能障礙', '生殖器不適'
                ],
                other: [
                    '全身不適', '多部位疼痛', '遊走性疼痛',
                    '症狀複雜', '難以描述的不適', '其他症狀'
                ]
            };
            
            // Define detailed locations for each body part
            const detailedLocations = {
                head: [
                    { value: 'forehead', text: '前額' },
                    { value: 'temples', text: '太陽穴' },
                    { value: 'top_head', text: '頭頂' },
                    { value: 'back_head', text: '後腦勺' },
                    { value: 'eyes', text: '眼部' },
                    { value: 'nose', text: '鼻部' },
                    { value: 'ears', text: '耳部' },
                    { value: 'mouth', text: '口部' },
                    { value: 'jaw', text: '下顎' },
                    { value: 'whole_head', text: '整個頭部' }
                ],
                neck: [
                    { value: 'front_neck', text: '前頸' },
                    { value: 'back_neck', text: '後頸' },
                    { value: 'side_neck', text: '側頸' },
                    { value: 'throat', text: '喉嚨' },
                    { value: 'whole_neck', text: '整個頸部' }
                ],
                chest: [
                    { value: 'upper_chest', text: '上胸部' },
                    { value: 'lower_chest', text: '下胸部' },
                    { value: 'left_chest', text: '左胸' },
                    { value: 'right_chest', text: '右胸' },
                    { value: 'heart_area', text: '心臟部位' },
                    { value: 'ribs', text: '肋骨' },
                    { value: 'whole_chest', text: '整個胸部' }
                ],
                abdomen: [
                    { value: 'upper_abdomen', text: '上腹部' },
                    { value: 'lower_abdomen', text: '下腹部' },
                    { value: 'left_abdomen', text: '左腹部' },
                    { value: 'right_abdomen', text: '右腹部' },
                    { value: 'navel', text: '肚臍周圍' },
                    { value: 'stomach', text: '胃部' },
                    { value: 'liver_area', text: '肝區' },
                    { value: 'whole_abdomen', text: '整個腹部' }
                ],
                back: [
                    { value: 'upper_back', text: '上背部' },
                    { value: 'middle_back', text: '中背部' },
                    { value: 'lower_back', text: '下背部/腰部' },
                    { value: 'left_back', text: '左背' },
                    { value: 'right_back', text: '右背' },
                    { value: 'spine', text: '脊椎' },
                    { value: 'shoulder_blade', text: '肩胛骨' },
                    { value: 'whole_back', text: '整個背部' }
                ],
                arms: [
                    { value: 'shoulders', text: '肩膀' },
                    { value: 'upper_arms', text: '上臂' },
                    { value: 'elbows', text: '手肘' },
                    { value: 'forearms', text: '前臂' },
                    { value: 'wrists', text: '手腕' },
                    { value: 'hands', text: '手掌' },
                    { value: 'fingers', text: '手指' },
                    { value: 'left_arm', text: '左手臂' },
                    { value: 'right_arm', text: '右手臂' },
                    { value: 'both_arms', text: '雙手臂' }
                ],
                legs: [
                    { value: 'hips', text: '臀部' },
                    { value: 'thighs', text: '大腿' },
                    { value: 'knees', text: '膝蓋' },
                    { value: 'calves', text: '小腿' },
                    { value: 'ankles', text: '腳踝' },
                    { value: 'feet', text: '腳掌' },
                    { value: 'toes', text: '腳趾' },
                    { value: 'left_leg', text: '左腿' },
                    { value: 'right_leg', text: '右腿' },
                    { value: 'both_legs', text: '雙腿' }
                ],
                joints: [
                    { value: 'shoulder_joint', text: '肩關節' },
                    { value: 'elbow_joint', text: '肘關節' },
                    { value: 'wrist_joint', text: '腕關節' },
                    { value: 'hip_joint', text: '髖關節' },
                    { value: 'knee_joint', text: '膝關節' },
                    { value: 'ankle_joint', text: '踝關節' },
                    { value: 'spine_joint', text: '脊椎關節' },
                    { value: 'multiple_joints', text: '多個關節' }
                ],
                skin: [
                    { value: 'face_skin', text: '面部皮膚' },
                    { value: 'body_skin', text: '身體皮膚' },
                    { value: 'hands_skin', text: '手部皮膚' },
                    { value: 'feet_skin', text: '足部皮膚' },
                    { value: 'scalp', text: '頭皮' },
                    { value: 'widespread_skin', text: '全身皮膚' }
                ],
                internal: [
                    { value: 'breathing', text: '呼吸系統' },
                    { value: 'digestion', text: '消化系統' },
                    { value: 'circulation', text: '循環系統' },
                    { value: 'nervous', text: '神經系統' },
                    { value: 'urinary', text: '泌尿系統' },
                    { value: 'reproductive', text: '生殖系統' },
                    { value: 'general_weakness', text: '全身無力' },
                    { value: 'fever', text: '發熱' }
                ],
                gynecology: [
                    { value: 'menstrual_issues', text: '月經問題' },
                    { value: 'vaginal_discharge', text: '白帶異常' },
                    { value: 'pelvic_pain', text: '骨盆腔疼痛' },
                    { value: 'breast_issues', text: '乳房問題' },
                    { value: 'menopause_symptoms', text: '更年期症狀' },
                    { value: 'fertility_issues', text: '生育相關' },
                    { value: 'urinary_gyneco', text: '泌尿婦科' },
                    { value: 'postpartum_issues', text: '產後問題' }
                ],
                andrology: [
                    { value: 'erectile_dysfunction', text: '勃起功能' },
                    { value: 'prostate_issues', text: '前列腺問題' },
                    { value: 'urinary_male', text: '泌尿問題' },
                    { value: 'testicular_pain', text: '睪丸疼痛' },
                    { value: 'fertility_male', text: '生育能力' },
                    { value: 'hormonal_male', text: '荷爾蒙問題' },
                    { value: 'sexual_function', text: '性功能障礙' },
                    { value: 'genital_issues', text: '生殖器問題' }
                ],
                other: [
                    { value: 'multiple_areas', text: '多個部位' },
                    { value: 'unclear_location', text: '位置不明確' },
                    { value: 'whole_body', text: '全身' },
                    { value: 'other_specify', text: '其他（請在補充描述中說明）' }
                ]
            };

            bodyPartSelect.addEventListener('change', function() {
                const selectedPart = this.value;
                detailedLocationSelect.innerHTML = '<option value="">請選擇詳細位置</option>';
                
                if (selectedPart && detailedLocations[selectedPart]) {
                    detailedLocationSelect.disabled = false;
                    detailedLocations[selectedPart].forEach(location => {
                        const option = document.createElement('option');
                        option.value = location.value;
                        option.textContent = location.text;
                        detailedLocationSelect.appendChild(option);
                    });
                    
                    // Generate symptoms for section 2
                    generateSymptomOptions(selectedPart);
                } else {
                    detailedLocationSelect.disabled = true;
                    // Clear symptoms if no body part selected
                    clearSymptomOptions();
                }
            });
            
            // Function to generate symptom options based on body part
            function generateSymptomOptions(bodyPart) {
                const symptomContainer = document.getElementById('symptomOptions');
                const symptomDescription = document.getElementById('symptomDescription');
                
                if (!bodyPart || !bodyPartSymptoms[bodyPart]) {
                    clearSymptomOptions();
                    return;
                }
                
                // Update description
                const bodyPartNames = {
                    head: '頭部',
                    neck: '頸部', 
                    chest: '胸部',
                    abdomen: '腹部',
                    back: '背部',
                    arms: '手臂',
                    legs: '腿部',
                    joints: '關節',
                    skin: '皮膚',
                    internal: '內科症狀',
                    gynecology: '婦科',
                    andrology: '男科',
                    other: '其他'
                };
                
                symptomDescription.innerHTML = `
                    <p class="text-blue-800 font-medium">您選擇了「${bodyPartNames[bodyPart]}」，請勾選相關症狀：</p>
                `;
                
                // Generate symptom checkboxes
                symptomContainer.innerHTML = '';
                bodyPartSymptoms[bodyPart].forEach(symptom => {
                    const label = document.createElement('label');
                    label.className = 'checkbox-item flex items-center cursor-pointer p-4 rounded-xl bg-gray-50 hover:bg-blue-50 border-2 border-gray-200 transition-all';
                    
                    label.innerHTML = `
                        <input type="checkbox" name="relatedSymptoms" value="${symptom}" class="sr-only">
                        <div class="flex items-center w-full">
                            <span class="text-lg font-medium">${symptom}</span>
                            <span class="ml-auto text-blue-500 opacity-0 transition-opacity">✓</span>
                        </div>
                    `;
                    
                    symptomContainer.appendChild(label);
                });
                
                // Re-setup interactive elements for new checkboxes
                setTimeout(() => {
                    setupInteractiveElements();
                }, 100);
            }
            
            function clearSymptomOptions() {
                const symptomContainer = document.getElementById('symptomOptions');
                const symptomDescription = document.getElementById('symptomDescription');
                
                symptomDescription.innerHTML = `
                    <p class="text-blue-800 font-medium">請先在第一步選擇身體部位，然後這裡會顯示相關症狀選項</p>
                `;
                symptomContainer.innerHTML = '';
            }
        }

        // Navigation
        document.getElementById('nextBtn').addEventListener('click', function() {
            if (validateCurrentSection()) {
                if (currentSection < totalSections) {
                    currentSection++;
                    showSection(currentSection);
                }
            }
        });

        document.getElementById('prevBtn').addEventListener('click', function() {
            if (currentSection > 1) {
                currentSection--;
                showSection(currentSection);
            }
        });

        // Form submission
        document.getElementById('diagnosisForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect all form data
            const formData = new FormData(this);
            const results = {};
            
            // Get sweat areas from text fields
            const sweatAreas = formData.get('sweatAreas');
            results['出汗部位'] = sweatAreas && sweatAreas.trim() ? sweatAreas.trim() : '無';
            
            // Process form data
            for (let [key, value] of formData.entries()) {
                if (results[key]) {
                    if (Array.isArray(results[key])) {
                        results[key].push(value);
                    } else {
                        results[key] = [results[key], value];
                    }
                } else {
                    results[key] = value;
                }
            }
            
            // Process checkboxes
            const checkboxGroups = ['relatedSymptoms', 'sweating', 'appetiteSymptoms', 'drinkingHabits', 'urination', 'stoolSymptoms', 'sleep', 'medicalHistory', 'currentMeds', 'allergies'];
            checkboxGroups.forEach(group => {
                const checked = document.querySelectorAll(`input[name="${group}"]:checked`);
                if (checked.length > 0) {
                    results[group] = Array.from(checked).map(cb => cb.value);
                }
            });
            
            displayResults(results);
        });

        function displayResults(results) {
            // 在顯示結果之前，將問診資料上傳至 Firestore（非同步執行）
            try {
                uploadInquiryData(results);
            } catch (_e) {
                // 忽略上傳錯誤以免影響 UI 顯示
            }

            // Hide the form container
            document.querySelector('.section-card').style.display = 'none';
            
            // Hide progress bar
            document.querySelector('.progress-container').style.display = 'none';
            
            // Create completion page
            const completionPage = document.createElement('div');
            completionPage.className = 'section-card bg-white rounded-2xl shadow-xl p-4 sm:p-8 form-container slide-in';
            completionPage.innerHTML = `
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-4">問診完成！</h2>
                    <p class="text-lg text-gray-600 mb-2">感謝您 <span class="font-semibold text-blue-600">${results.patientName || '患者'}</span> 完成詳細的問診</p>
                    <p class="text-gray-600">您的問診資料已成功收集，此結果將提供給您的中醫師參考</p>
                </div>

                <div class="bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-xl p-6 mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        問診摘要
                    </h3>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div class="bg-white rounded-lg p-4">
                            <h4 class="font-semibold text-gray-700 mb-2">主要症狀</h4>
                            <p class="text-gray-600">${getMainSymptom(results)}</p>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h4 class="font-semibold text-gray-700 mb-2">體質特點</h4>
                            <p class="text-gray-600">${getConstitutionSummary(results)}</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 mb-8">
                    ${generateDetailedResults(results)}
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-8">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-2 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        重要提醒
                    </h3>
                    <ul class="text-yellow-700 text-sm space-y-1">
                        <li>• 此問診結果將會供中醫師參考，不能替代正式醫療診斷</li>
                        <li>• 預先問診填寫後請稍等片刻，正在處理你提交的資料</li>
                        <li>• 如有緊急症狀，請立即就醫</li>
                    </ul>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="printResults()" class="btn-secondary px-8 py-4 text-white rounded-xl font-semibold text-lg flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                        </svg>
                        列印結果
                    </button>
                    <button onclick="restartDiagnosis()" class="btn-primary px-8 py-4 text-white rounded-xl font-semibold text-lg flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        重新問診
                    </button>
                </div>
            `;
            
            // Insert the completion page
            document.querySelector('.container').appendChild(completionPage);
        }

        function getMainSymptom(results) {
            const bodyPartNames = {
                head: '頭部', neck: '頸部', chest: '胸部', abdomen: '腹部',
                back: '背部', arms: '手臂', legs: '腿部', joints: '關節',
                skin: '皮膚', internal: '內科症狀', gynecology: '婦科', andrology: '男科', other: '其他'
            };
            
            let symptom = bodyPartNames[results.bodyPart] || '未指定部位';
            // 當使用者有選擇詳細位置時，嘗試將英文代碼轉換為對應的中文名稱。
            // 部位選項的值（value）是英文，但顯示文本是中文；
            // 若直接使用英文字串顯示會導致問診摘要出現英文主訴。
            if (results.detailedLocation) {
                // 在表單的詳細位置下拉選單中尋找符合值的選項，取得其顯示文字
                const optionEl = document.querySelector(`#detailedLocation option[value="${results.detailedLocation}"]`);
                const locName = optionEl ? optionEl.textContent : results.detailedLocation;
                symptom += ' - ' + locName;
            }
            // 顯示相關症狀（最多三個），若為陣列則用頓號連接
            if (results.relatedSymptoms && results.relatedSymptoms.length > 0) {
                symptom += '：' + (Array.isArray(results.relatedSymptoms) ? results.relatedSymptoms.slice(0, 3).join('、') : results.relatedSymptoms);
            }
            return symptom;
        }

        function getConstitutionSummary(results) {
            let constitution = [];
            if (results.temperature) constitution.push(results.temperature);
            if (results.sweating) constitution.push(results.sweating);
            if (results.energy) constitution.push(results.energy);
            return constitution.length > 0 ? constitution.join('、') : '體質平和';
        }

        function generateDetailedResults(results) {
            const sections = {
                '基本資料': ['patientName', 'gender', 'bodyPart', 'detailedLocation', 'additionalSymptoms'],
                '相關症狀': ['relatedSymptoms'],
                '汗出情況': ['sweating', '出汗部位'],
                '寒熱情況': ['temperature', 'coldHands'],
                '胃口情況': ['appetite', 'appetiteSymptoms', 'foodPreference'],
                '飲水情況': ['drinkingPreference', 'drinkingHabits'],
                '小便情況': ['urination', 'nightUrination', 'dailyUrination', 'urineColor'],
                '大便情況': ['stoolForm', 'stoolSymptoms', 'stoolFrequency', 'stoolOdor', 'stoolColor'],
                '睡眠情況': ['sleep'],
                '體力精神': ['energy', 'morningEnergy', 'concentration'],
                '病史': ['medicalHistory', 'detailedMedicalHistory'],
                '用藥及過敏': ['currentMeds', 'allergies', 'otherAllergies']
            };
            
            let html = '';
            Object.entries(sections).forEach(([sectionName, fields]) => {
                let sectionHtml = `<div class="border border-gray-200 rounded-lg p-4">`;
                sectionHtml += `<h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                    <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                    ${sectionName}
                </h4>`;
                
                let hasContent = false;
                fields.forEach(field => {
                    if (results[field] && results[field] !== '' && results[field] !== '無') {
                        hasContent = true;
                        let value = results[field];
                        // 將陣列值合併為逗號分隔的中文陣列
                        if (Array.isArray(value)) {
                            value = value.join('、');
                        } else {
                            // 對於英文代碼的部位及詳細位置轉換為中文顯示
                            if (field === 'bodyPart') {
                                const optionEl = document.querySelector(`#bodyPart option[value="${value}"]`);
                                value = optionEl ? optionEl.textContent : value;
                            } else if (field === 'detailedLocation') {
                                const optionEl = document.querySelector(`#detailedLocation option[value="${value}"]`);
                                value = optionEl ? optionEl.textContent : value;
                            }
                        }
                        sectionHtml += `<div class="mb-2 pl-4 border-l-2 border-gray-100">
                            <span class="text-sm font-medium text-gray-700">${getFieldLabel(field)}：</span>
                            <span class="text-sm text-gray-600">${value}</span>
                        </div>`;
                    }
                });
                
                if (!hasContent) {
                    sectionHtml += '<p class="text-sm text-gray-400 pl-4">無相關資料</p>';
                }
                
                sectionHtml += '</div>';
                html += sectionHtml;
            });
            
            return html;
        }

        /**
         * 將問診資料上傳至 Firestore。
         * 使用 firebase_init.js 中初始化的 window.firebase 物件。
         *
         * @param {Object} results 問診結果物件
         */
        async function uploadInquiryData(results) {
            try {
                // 確保 Firebase 已初始化
                if (!window.firebase || !window.firebase.db) {
                    console.warn('Firebase 未初始化，無法上傳問診資料');
                    return;
                }
                // 設置創建和過期時間
                const timestamp = new Date();
                const expireAt = new Date(Date.now() + 24 * 60 * 60 * 1000);
                // 新增至 inquiries 集合
                await window.firebase.addDoc(
                    window.firebase.collection(window.firebase.db, 'inquiries'),
                    {
                        patientName: results.patientName || '',
                        data: results,
                        createdAt: timestamp,
                        expireAt: expireAt
                    }
                );
                console.log('問診資料已成功儲存');
            } catch (err) {
                console.error('上傳問診資料發生錯誤:', err);
            }
        }

        function getFieldLabel(field) {
            const labels = {
                'patientName': '姓名',
                'gender': '性別',
                'bodyPart': '身體部位',
                'detailedLocation': '詳細位置',
                'additionalSymptoms': '補充症狀',
                'relatedSymptoms': '相關症狀',
                'sweating': '汗出',
                '出汗部位': '出汗部位',
                'temperature': '寒熱',
                'coldHands': '手腳冰冷',
                'appetite': '食慾',
                'appetiteSymptoms': '胃口症狀',
                'foodPreference': '食物偏好',
                'drinkingPreference': '飲水偏好',
                'drinkingHabits': '飲水習慣',
                'urination': '小便症狀',
                'nightUrination': '夜尿次數',
                'dailyUrination': '日間小便次數',
                'urineColor': '小便顏色',
                'stoolForm': '大便形狀',
                'stoolSymptoms': '大便症狀',
                'stoolFrequency': '大便頻率',
                'stoolOdor': '大便氣味',
                'stoolColor': '大便顏色',
                'sleep': '睡眠',
                'energy': '精神狀態',
                'morningEnergy': '晨起精神',
                'concentration': '注意力',
                'medicalHistory': '病史',
                'detailedMedicalHistory': '詳細病史',
                'currentMeds': '目前用藥',
                'allergies': '過敏史',
                'otherAllergies': '其他過敏'
            };
            return labels[field] || field;
        }

        function validateCurrentSection() {
            const section = document.getElementById(`section${currentSection}`);
            let isValid = true;
            let errorMessage = '';

            // Remove previous error messages
            section.querySelectorAll('.error-message').forEach(msg => msg.remove());

            switch(currentSection) {
                case 1: // Basic Info
                    // Check name input
                    const patientName = section.querySelector('input[name="patientName"]').value.trim();
                    if (!patientName) {
                        showError(section.querySelector('input[name="patientName"]'), '請輸入姓名');
                        isValid = false;
                    }
                    
                    // Check gender selection
                    const genderSelected = section.querySelector('input[name="gender"]:checked');
                    if (!genderSelected) {
                        showError(section.querySelector('input[name="gender"]').closest('div'), '請選擇性別');
                        isValid = false;
                    }
                    
                    // Check body part selection
                    const bodyPart = section.querySelector('select[name="bodyPart"]').value;
                    if (!bodyPart) {
                        showError(section.querySelector('select[name="bodyPart"]'), '請選擇身體部位');
                        isValid = false;
                    }
                    
                    // Check detailed location selection
                    const detailedLocation = section.querySelector('select[name="detailedLocation"]').value;
                    if (bodyPart && !detailedLocation) {
                        showError(section.querySelector('select[name="detailedLocation"]'), '請選擇詳細位置');
                        isValid = false;
                    }
                    break;

                case 2: // Additional Symptoms - Optional, can skip
                    break;

                case 3: // Sweating
                    const sweatingSelected = section.querySelector('input[name="sweating"]:checked');
                    if (!sweatingSelected) {
                        showError(section.querySelector('input[name="sweating"]').closest('div').parentElement, '請選擇汗出情況');
                        isValid = false;
                    }
                    break;

                case 4: // Temperature
                    const temperatureSelected = section.querySelector('input[name="temperature"]:checked');
                    if (!temperatureSelected) {
                        showError(section.querySelector('input[name="temperature"]').closest('div').parentElement, '請選擇寒熱情況');
                        isValid = false;
                    }
                    break;

                case 5: // Appetite
                    const appetiteSelected = section.querySelector('input[name="appetite"]:checked');
                    if (!appetiteSelected) {
                        showError(section.querySelector('input[name="appetite"]').closest('div').parentElement, '請選擇食慾狀況');
                        isValid = false;
                    }
                    break;

                case 6: // Drinking
                    const drinkingSelected = section.querySelector('input[name="drinkingPreference"]:checked');
                    if (!drinkingSelected) {
                        showError(section.querySelector('input[name="drinkingPreference"]').closest('div').parentElement, '請選擇飲水偏好');
                        isValid = false;
                    }
                    break;

                case 7: // Urination
                    const nightUrination = section.querySelector('input[name="nightUrination"]').value;
                    const dailyUrination = section.querySelector('input[name="dailyUrination"]').value;
                    
                    if (!nightUrination) {
                        showError(section.querySelector('input[name="nightUrination"]'), '請填寫夜尿次數');
                        isValid = false;
                    }
                    if (!dailyUrination) {
                        showError(section.querySelector('input[name="dailyUrination"]'), '請填寫每日小便次數');
                        isValid = false;
                    }
                    
                    const urineColor = section.querySelector('input[name="urineColor"]').value;
                    if (!urineColor) {
                        showError(section.querySelector('#selectedUrineColor').parentElement, '請選擇小便顏色');
                        isValid = false;
                    }
                    break;

                case 8: // Bowel Movement
                    const stoolFormSelected = section.querySelector('input[name="stoolForm"]:checked');
                    if (!stoolFormSelected) {
                        showError(section.querySelector('input[name="stoolForm"]').closest('div').parentElement, '請選擇大便形狀');
                        isValid = false;
                    }
                    
                    const stoolFrequency = section.querySelector('input[name="stoolFrequency"]').value.trim();
                    if (!stoolFrequency) {
                        showError(section.querySelector('input[name="stoolFrequency"]'), '請填寫大便頻率');
                        isValid = false;
                    }
                    
                    const stoolOdor = section.querySelector('select[name="stoolOdor"]').value;
                    if (!stoolOdor) {
                        showError(section.querySelector('select[name="stoolOdor"]'), '請選擇大便氣味');
                        isValid = false;
                    }
                    
                    const stoolColor = section.querySelector('input[name="stoolColor"]').value;
                    if (!stoolColor) {
                        showError(section.querySelector('#selectedStoolColor').parentElement, '請選擇大便顏色');
                        isValid = false;
                    }
                    break;

                case 9: // Sleep
                    const sleepQualitySelected = section.querySelector('input[name="sleepQuality"]:checked');
                    if (!sleepQualitySelected) {
                        showError(section.querySelector('input[name="sleepQuality"]').closest('div').parentElement, '請選擇睡眠品質');
                        isValid = false;
                    }
                    break;

                case 10: // Energy
                    const energySelected = section.querySelector('input[name="energy"]:checked');
                    if (!energySelected) {
                        showError(section.querySelector('input[name="energy"]').closest('div').parentElement, '請選擇精神狀態');
                        isValid = false;
                    }
                    break;

                case 11: // Medical History - Optional, can skip
                    break;

                case 12: // Current Medications & Allergies - Optional, can skip
                    break;
            }

            if (!isValid) {
                // Scroll to first error
                const firstError = section.querySelector('.error-message');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            return isValid;
        }

        function showError(element, message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message text-red-600 text-sm mt-1 font-medium';
            errorDiv.textContent = message;
            
            // Insert after the element
            if (element.tagName === 'DIV') {
                element.appendChild(errorDiv);
            } else {
                element.parentNode.insertBefore(errorDiv, element.nextSibling);
            }
        }

        function printResults() {
            window.print();
        }

        function restartDiagnosis() {
            // Reset form
            document.getElementById('diagnosisForm').reset();
            
            // Remove completion page
            const completionPage = document.querySelector('.container').lastElementChild;
            if (completionPage && completionPage.classList.contains('slide-in')) {
                completionPage.remove();
            }
            
            // Show form container and progress bar
            document.querySelector('.section-card').style.display = 'block';
            document.querySelector('.progress-container').style.display = 'block';
            
            // Reset to first section
            currentSection = 1;
            showSection(1);
            
            // Clear color selections
            document.querySelectorAll('.color-option.selected').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('selectedUrineColor').textContent = '未選擇';
            document.getElementById('selectedStoolColor').textContent = '未選擇';
            
            // Reset body part selector
            document.getElementById('detailedLocation').disabled = true;
            document.getElementById('detailedLocation').innerHTML = '<option value="">請先選擇身體部位</option>';
            
            // Clear symptom options
            document.getElementById('symptomOptions').innerHTML = '';
            document.getElementById('symptomDescription').innerHTML = '<p class="text-blue-800 font-medium">請先在第一步選擇身體部位，然後這裡會顯示相關症狀選項</p>';
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closeResults() {
            const modal = document.getElementById('resultsModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'973827d9177a09dc',t:'MTc1NTkyNjM3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"7939e04a4baf43c8b86a560f74aac60e","server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
